//<script type="text/javascript">

// Auto generated file - created by app.Builder.js- do not edit directly (at present!)

Roo.namespace('Pman.Dialog');

Pman.Dialog.PressReleaseEdit = {

 _strings : {
  'f31bbdd1b3e85bccd652680e16935819' :"Source",
  '2f26e35d61be90501e099089dc533638' :"Select Images",
  '90e02e896b4ee833a24236b45060d175' :"Description / Byline",
  '91412465ea9169dfd901dd5e7c96dd99' :"Upload",
  'c1df1da7a1ce305a3b60af9d5733ac1d' :"Contents",
  'f0bac093bb884df2891d32385d053788' :"Distribution",
  '4e97aeeaa8b15ca1180fcd1f3ac478d1' :"When",
  'f2a6c498fb90ee345d997f888fce3b18' :"Delete",
  'b1515c8965e8b24b15046bb2afe27123' :"Sub-Headline",
  '01a5bf98dc3a43bb2f6d0787d87030b7' :"Add From Image Store",
  '3f0f4d7d0b92612398cc55d9e47965e2' :"Financial Data",
  'c864347be68dbc6a7b0540f1f79d8ea3' :"Reset selections",
  'c78bf45129eff892d5c654c159fd8182' :"Displaying pressrelease_notify{0} - {1} of {2}",
  '231bc72756b5e6de492aaaa1577f61b1' :"Remarks",
  '31fde7b05ac8952dacf4af8a704074ec' :"Preview",
  'c6568e77f61109390e82d035aaacaef0' :"Headline",
  '9c715f0e523e7e1d00d538db7b78615b' :"Word count",
  'e0626222614bdee31951d84c64e5e9ff' :"Select",
  'a1fa27779242b4902f7ae3bdd5c6d508' :"Type",
  'a97749f6323c1743aad997aaf0197b19' :"Remove undelivered messages",
  '2dd37afd617264989a9dbad32cc239ad' :" same as (different publish dates)",
  '9aa698f602b1e5694855cee73a683488' :"Contacts",
  '471ddaf9e80da04dd5a3a54daa0239b0' :"Select Image Type",
  'c9289663240146eaa1ec2d9838b0875a' :"News Beat",
  '47b09b64b87dc1cb923065dd6167ecde' :"No pressrelease_notify found",
  'd171235ac80dfa3cd3c83d27312565e5' :"Stock Code",
  '336f78a6c761db5eb97973c04b0a2fe0' :"Release Details",
  '47bd5f0bae18a1ce015e40d73a33a15f' :"Company Boiler Plate Statement",
  'c00adc22f2bb333883dc1723e2899a0c' :"Related Web Links <B>Must have http:// before the link</b>",
  'b18c29b8470190a02813415a04a2191f' :"Filesize",
  '9c9745a343efeacc9efe9b7222b27afb' :"Ref#",
  '95291adff6df977dbba485210bcf6b3c' :"pressrelease_entry",
  'ad5fd38e083fd0d559ca3f54fa7ed593' :"Upload Excel of Financial data",
  'ec211f7c20af43e742bf2570c3cb84f9' :"Add",
  'cd1195c061c70621a670027d606c0be0' :"Fill this in when this release goes out at a different time",
  '1243daf593fa297e07ab03bf06d925af' :"Searching...",
  '11f7b456ca765e9f556f653090045ae7' :"Images / PDF",
  '577d7068826de925ea2aec01dbadf5e4' :"Client",
  '5f159bce162b1b90e6ffc45602f151ea' :"This press release is a translation of",
  '7205d42d6d975c911bc1147259d78935' :"Displaying Events{0} - {1} of {2}",
  '97e7c9a7d06eac006a28bf05467fcc8b' :"Link",
  '867343577fa1f33caa632a19543bd252' :"Keywords",
  'addf678354e22ee4f52fefb5f25069d1' :"Select Client",
  '15ec5490b30354020a6756796c5e4835' :"Edit Press Release",
  'ec53a8c4f07baed5d8825072c89799be' :"Status",
  '20e9dc20a361244eb40c7b723a393995' :"Forward Looking Statement",
  '55cfeeacad2f92b9fea0a1bbb6449fac' :"Update Image Details",
  '526d688f37a86d3c3f27d0c5016eb71d' :"Reset",
  'b9e14d9b2886bcff408b85aefa780419' :"FAILED",
  'ea4788705e6873b424c65e91c2846b19' :"Cancel",
  'a76d4ef5f3f6a672bbfab2865563e530' :"Time",
  '69046eb2a80f3965bcd41bfdb1a7bf5c' :"Add Keyword",
  'c4ca4238a0b923820dcc509a6f75849b' :"1",
  'cc8498ab909997b95b2207684dbce5cf' :"Select industry",
  'b9ea5920734c27f9ec7596d53589fb3c' :"Select Press release",
  '4994a8ffeba4ac3140beb89e8d41f174' :"Language",
  '432c508d90a57863d3800a123fdefa23' :"Financial Content",
  '8e16a71b3d8217eb80b39b7d8dec4296' :"Image Type",
  '4b1b4dc8cf38b3c64b1d657da8f5ac8c' :"Report",
  'b9dc4c481b230aaec437ef58b23ca1ef' :" (Chinese) Name",
  '2bb46cdcd6c198689d1c95ac20bba931' :"Beat",
  '917d465e9a9e8b16a8da50a1ca8156ca' :"Show: ",
  'dc9227804a61468a485e682cb932bdf7' :"Company Details",
  'df1390c4238324679161da9c6652d17a' :"Select Exchange",
  'b78a3223503896721cca1303f776159b' :"Title",
  '8567f15f1470a10fcb0dfa920ac7c21b' :"Force Re-delivery",
  '90e4ac2e5a22e53df63b6b186d8727ba' :"No Events found",
  '4ee972120bcda675f75222c87cb9d356' :"Who",
  'd7df5b64df1181ef1d62d646a13aa860' :"keyword",
  'c91c7b93c28cd18741b71f727ee81ee3' :"Reports",
  '446a6000511ab6fb0711400379a62a04' :"Select Image",
  'f15c1cae7882448b3fb0404682e17e61' :"Content",
  '236df51bb0e6416236e255b528346fca' :"Timezone",
  '110a4b01beabd53b661a47d4b44bd7a8' :"Publish",
  '59716c97497eb9694541f7c3d37b1a4d' :"Country",
  '801ab24683a4a8c433c6eb40c48bcd9d' :"Download",
  '992374d8e2e24f17bebc50a6e57becd6' :"Exchange",
  '4fd0a37b0a02153b23bbb61d7915a429' :"Industry",
  '8189ecf686157db0c0274c1f49373318' :"International",
  '122a26ef126e03089bb959c949d12b0a' :"Due out (Local time)",
  'cbe695bf80e8066f16a941601cd6846b' :"Select exchange",
  '45e96c0a422ce8a1a6ec1bd5eb9625c6' :"Select All",
  'e12167aa0a7698e6ebc92b4ce3909b53' :"To",
  '7f8c0283f16925caed8e632086b81b9c' :"Sent",
  'b112803ab9deb7deba2a6b24ef3bb91a' :"Add Group",
  'c9cc8cce247e49bae79f15173ce97354' :"Save",
  'ea72bacd2fdfa818907bb9559e6905a1' :"Upload Image or File",
  'fff0d600f8a0b5e19e88bfb821dd1157' :"Images",
  'c9d03748d1a54666b5c7a5187109301b' :"Delete Selected File or  Image",
  '8535bcc0f05358a583bb432bbadf7e0d' :"Select type",
  'f45381a54504218e39aca33492d29306' :"Circulation",
  '004bf6c9a40003140292e97330236c53' :"Action",
  '0a90b1bc4078f74b6f0d117ec7df65af' :"Credit",
  '529701d5ccccf8a1c604c27f48ce7d82' :"Mimetype",
  '4d1c8263ba1036754f8db14a98f9f006' :"Reload",
  'ce0be71e33226e4c1db2bcea5959f16b' :"Log"
 },

 dialog : false,
 callback:  false,

 show : function(data, cb)
 {
  if (!this.dialog) {
   this.create();
  }

  this.callback = cb;
  this.data = data;
  this.dialog.show(this.data._el);
  if (this.form) {
   this.form.reset();
   this.form.setValues(data);
   this.form.fireEvent('actioncomplete', this.form,  { type: 'setdata', data: data });
  }

 },

 create : function()
 {
   var _this = this;
   this.dialog = Roo.factory({
    closable : false,
    collapsible : false,
    height : 600,
    minHeight : 650,
    minWidth : 810,
    modal : true,
    resizable : true,
    title : _this._strings['15ec5490b30354020a6756796c5e4835'] /* Edit Press Release */,
    width : 810,
    xns : Roo,
    '|xns' : 'Roo',
    xtype : 'LayoutDialog',
    center : {
     alwaysShowTabs : true,
     tabPosition : 'top',
     xns : Roo,
     '|xns' : 'Roo',
     xtype : 'LayoutRegion'
    },
    buttons : [
     {
      text : _this._strings['ea4788705e6873b424c65e91c2846b19'] /* Cancel */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'Button',
      listeners : {
       click : function (_self, e)
        {
            _this.dialog.hide();
        }
      }
     },
     {
      text : _this._strings['31fde7b05ac8952dacf4af8a704074ec'] /* Preview */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'Button',
      listeners : {
       click : function (_self, e)
        {
            
           
            var lang = _this.form.findField('language').getValue();
            if (!lang.length) {
                Roo.MessageBox.alert("Error", "No Lanugage has been set");
                return;
            }
         
           
            _this.showPreview = function() {
            
                var id = _this.form.findField('id').getValue()  * 1;
                if (!id) {
                    Roo.MessageBox.alert("Error", "Could not find ID after saving?");
                    return;
                }
            
                Pman.Dialog.PressReleasePreview.show({
                    id : id,
                    title : _this.form.findField('headline').getValue(),
                    blacklist_ids :   _this.form.findField('blacklist_ids').getValue(),
                    beats:   _this.form.findField('distribution_config').getValue(),
                    countries :  _this.form.findField('distribution_countries').getValue() 
                    
                  }, function()
                {
                    _this.showPreview = false;
                });
            }
             _this.form.doAction("submit");
             
            
        }
      }
     },
     {
      text : _this._strings['c9cc8cce247e49bae79f15173ce97354'] /* Save */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'Button',
      listeners : {
       click : function (_self, e)
        {
            // do some checks?
             
            var lang = _this.form.findField('language').getValue();
            if (!lang.length) {
                Roo.MessageBox.alert("Error", "No Lanugage has been set");
                return;
            }
         
            _this.form.doAction("submit");
        
        }
      }
     }
    ],
    items  : [
     {
      autoScroll : true,
      fitToFrame : true,
      region : 'center',
      title : _this._strings['c1df1da7a1ce305a3b60af9d5733ac1d'] /* Contents */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'ContentPanel',
      listeners : {
       activate : function (_self)
        {
          if (_this.form) {
              _this.form.updateWordCount();
          }
          
        },
       deactivate : function (_self)
        {
            
            //Roo.log('deactivate ' + _this.loaded);
            if (!_this.loaded) {
                return;
            }
            //Roo.log(_this.form.findField('id').getValue());
            if (_this.form.findField('id').getValue() * 1 > 0) {
                return;
            }
            (function() {
                Roo.MessageBox.alert("Error", "Save first");
                _this.dialog.layout.getRegion('center').showPanel(0);
            }).defer(100);
        
        
        }
      },
      items  : [
       {
        method : 'POST',
        style : 'margin: 10px;',
        updateWordCount : function() {
            var wc = 0;
            
            function html2wc(val)
            {
                var d = document.createElement('div');
                d.innerHTML =val;
                return txt2wc(Roo.isIE ? d.innerText : d.textContent);
            
            }
            function txt2wc(val) {
                return val.split(/\s+/).length;
            }
            
            wc += html2wc(this.findField('content').getValue());
            wc += txt2wc(_this.form2.findField('contact_txt').getValue());    
            wc += txt2wc(_this.form2.findField('content_about').getValue());        
            wc += txt2wc(_this.form2.findField('content_links').getValue());        
            wc += txt2wc(_this.form3.findField('content_forward').getValue());        
            wc += html2wc(_this.form3.findField('content_data').getValue());
            this.findField('word_count').setValue(wc);
            
        },
        url : baseURL + '/Roo/pressrelease_entry.php',
        xns : Roo.form,
        '|xns' : 'Roo.form',
        xtype : 'Form',
        listeners : {
         actioncomplete : function(_self,action)
          {
              
               if (action.failureType) {
           
                 
                  Roo.MessageBox.alert("Error", "Please correct the errors in red");
                  return;
              
              }
            if (action.type == 'setdata') {
                  _this.loaded = false;
           
                 _this.dialog.getLayout().showPanel(0);
                  _this.form.addForm(_this.form2);
                    _this.form.addForm(_this.form3);
                  if ( _this.data.id) {
                      _this.dialog.setTitle("Edit Press Release #" + _this.data.id);
                     this.load({ method: 'GET', params: { '_id' : _this.data.id }});
                 } else {
                  
                     _this.dialog.setTitle("Create a new  Press Release");
                     
                    _this.loaded = true;
                    _this.form.findField('publish_status').setValue(-1);
                    _this.form.findField('distribute_to_feed').setValue(1);
                 }
                 
                 return;
              }
              if (action.type == 'load') {
                  _this.loaded = true;
                 var fd  =  _this.form3.findField('content_data').getValue(); 
          
                 // not it uses mostly HTML..
                 //if (!fd.match(/<pre>/i)) {
                  //     _this.form3.findField('content_data').setValue('<pre>' + String.format('{0}', fd.replace(/\&nbsp;/g, ' ').replace(/\&amp;nbsp;/g, ' ')) +  '</pre>'); 
                   //}   
                 
                  if (_this.data._translation_of) {
                      this.setValues({
                          id : 0,
                          parent_id  : _this.data.id,
                          parent_id_headline  : this.findField('headline').getValue(),
                          language : '',
                          language_name : '',                
                          content : '',
                          headline: '',
                          publish_status : -1
                          
                      });
                      //this.findField('language').el.dom.value = '';
                      _this.data.id = 0;
                  }
                  //_this.loadedData = action.result.data;
                  this.updateWordCount();
                  
                 
                  return;
              }
              if (action.type =='submit') {
              
                  var hide = true;
                  if (_this.form.findField('id').getValue() * 1 < 1) {
                      hide = false;
                      _this.form.findField('id').setValue(action.result.data.id);
                  }
                  
                  if (_this.showPreview) {
                      _this.showPreview();
                      _this.showPreview = false;
                      return;
                  }
                  
                  if (!hide) {
                      return;
                  }
                  _this.dialog.hide();
              
                   if (_this.callback) {
                      _this.callback.call(_this, _this.form.getValues());
                   }
                   _this.form.reset();
                   return;
              }
          },
         actionfailed : function (_self, action)
          {
             if (action.failureType) {
                    _this.dialog.el.unmask();
                 
                  Roo.MessageBox.alert("Error", "Please correct the errors in red");
                  return;
              
              }
          },
         rendered : function (form)
          {
              _this.form= form;
            
          }
        },
        items  : [
         {
          labelWidth : 75,
          legend : _this._strings['336f78a6c761db5eb97973c04b0a2fe0'] /* Release Details */,
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'FieldSet',
          items  : [
           {
            labelWidth : 240,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'Row',
            items  : [
             {
              alwaysQuery : true,
              displayField : 'headline',
              editable : false,
              emptyText : _this._strings['b9ea5920734c27f9ec7596d53589fb3c'] /* Select Press release */,
              fieldLabel : _this._strings['5f159bce162b1b90e6ffc45602f151ea'] /* This press release is a translation of */,
              forceSelection : true,
              hiddenName : 'parent_id',
              listWidth : 400,
              loadingText : _this._strings['1243daf593fa297e07ab03bf06d925af'] /* Searching... */,
              minChars : 2,
              name : 'parent_id_headline',
              pageSize : 20,
              qtip : _this._strings['b9ea5920734c27f9ec7596d53589fb3c'] /* Select Press release */,
              queryParam : 'query[name]',
              selectOnFocus : true,
              tpl : '<div class=\"x-grid-cell-text x-btn button\"><b>#{id} - {headline}</b> </div>',
              triggerAction : 'all',
              typeAhead : true,
              valueField : 'id',
              width : 420,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'ComboBox',
              store : {
               remoteSort : true,
               sortInfo : { direction : 'DESC', field: 'id' },
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'Store',
               listeners : {
                beforeload : function (_self, o){
                     o.params = o.params || {};
                     var client_id = _this.form.findField('client_id').getValue();
                     if (!client_id) {
                         Roo.MessageBox.alert("Error", "Select a client first");
                         return false;
                     }
                     o.params.client_id = client_id;
                     o.params.parent_id = 0; /// only releases that do not have a parent..
                     var id = _this.form.findField('id').getValue();
                     if (id ) {
                         o.params['!id'] = id;
                     }
                     // set more here
                 }
               },
               proxy : {
                method : 'GET',
                url : baseURL + '/Roo/pressrelease_entry.php',
                xns : Roo.data,
                '|xns' : 'Roo.data',
                xtype : 'HttpProxy'
               },
               reader : {
                fields : [{"name":"id","type":"int"},{"name":"language","type":"string"}],
                id : 'id',
                root : 'data',
                totalProperty : 'total',
                xns : Roo.data,
                '|xns' : 'Roo.data',
                xtype : 'JsonReader'
               }
              }
             },
             {
              alwaysQuery : true,
              displayField : 'headline',
              editable : false,
              emptyText : _this._strings['cd1195c061c70621a670027d606c0be0'] /* Fill this in when this release goes out at a different time */,
              fieldLabel : _this._strings['2dd37afd617264989a9dbad32cc239ad'] /*  same as (different publish dates) */,
              forceSelection : true,
              hiddenName : 'same_as_id',
              listWidth : 400,
              loadingText : _this._strings['1243daf593fa297e07ab03bf06d925af'] /* Searching... */,
              minChars : 2,
              name : 'same_as_id_headline',
              pageSize : 20,
              qtip : _this._strings['b9ea5920734c27f9ec7596d53589fb3c'] /* Select Press release */,
              queryParam : 'query[name]',
              selectOnFocus : true,
              tpl : '<div class=\"x-grid-cell-text x-btn button\"><b>#{id} - {headline}</b> </div>',
              triggerAction : 'all',
              typeAhead : true,
              valueField : 'id',
              width : 420,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'ComboBox',
              store : {
               remoteSort : true,
               sortInfo : { direction : 'DESC', field: 'id' },
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'Store',
               listeners : {
                beforeload : function (_self, o){
                     o.params = o.params || {};
                     var client_id = _this.form.findField('client_id').getValue();
                     if (!client_id) {
                         Roo.MessageBox.alert("Error", "Select a client first");
                         return false;
                     }
                     o.params.client_id = client_id;
                     o.params.parent_id = 0; /// only releases that do not have a parent..
                     var id = _this.form.findField('id').getValue();
                     if (id ) {
                         o.params['!id'] = id;
                     }
                     // set more here
                 }
               },
               proxy : {
                method : 'GET',
                url : baseURL + '/Roo/pressrelease_entry.php',
                xns : Roo.data,
                '|xns' : 'Roo.data',
                xtype : 'HttpProxy'
               },
               reader : {
                fields : [{"name":"id","type":"int"},{"name":"language","type":"string"}],
                id : 'id',
                root : 'data',
                totalProperty : 'total',
                xns : Roo.data,
                '|xns' : 'Roo.data',
                xtype : 'JsonReader'
               }
              }
             }
            ]
           },
           {
            labelWidth : 75,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'Row',
            items  : [
             {
              allowBlank : false,
              displayField : 'fname',
              editable : false,
              fieldLabel : _this._strings['ec53a8c4f07baed5d8825072c89799be'] /* Status */,
              hiddenName : 'publish_status',
              listWidth : 200,
              mode : 'local',
              name : 'publish_status_name',
              triggerAction : 'all',
              valueField : 'ftype',
              width : 200,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'ComboBox',
              store : {
               data : [ [-1, "Draft"],[ 0 , "Ready to Distribute"],[ 1, "Embargoed"] ],
               fields : [  'ftype', 'fname'],
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'SimpleStore'
              }
             },
             {
              allowBlank : true,
              alwaysQuery : true,
              displayField : 'hgroup',
              editable : false,
              fieldLabel : _this._strings['4fd0a37b0a02153b23bbb61d7915a429'] /* Industry */,
              forceSelection : true,
              listWidth : 400,
              loadingText : _this._strings['1243daf593fa297e07ab03bf06d925af'] /* Searching... */,
              minChars : 2,
              name : 'industry_name',
              pageSize : 150,
              qtip : _this._strings['cc8498ab909997b95b2207684dbce5cf'] /* Select industry */,
              queryParam : 'query[hgroup]',
              selectOnFocus : true,
              tpl : '<div class=\"x-grid-cell-text x-btn button\"><b>{hgroup}</b> </div>',
              triggerAction : 'all',
              typeAhead : true,
              valueField : 'hgroup',
              width : 300,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'ComboBox',
              store : {
               remoteSort : true,
               sortInfo : { direction : 'ASC', field: 'hgroup' },
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'Store',
               listeners : {
                beforeload : function (_self, o){
                     o.params = o.params || {};
                     // set more here
                     o.params['_distinct']='hgroup';
                     o.params['!hgroup']='';
                     o.params['parent_id_name'] = 'News Beat';
                     o.params['_columns'] = 'hgroup';
                 }
               },
               proxy : {
                method : 'GET',
                url : baseURL + '/Roo/pressrelease_category.php',
                xns : Roo.data,
                '|xns' : 'Roo.data',
                xtype : 'HttpProxy'
               },
               reader : {
                fields : [{"name":"id","type":"int"},{"name":"name","type":"string"}],
                id : 'id',
                root : 'data',
                totalProperty : 'total',
                xns : Roo.data,
                '|xns' : 'Roo.data',
                xtype : 'JsonReader'
               }
              }
             }
            ]
           },
           {
            labelWidth : 75,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'Row',
            items  : [
             {
              allowBlank : true,
              alwaysQuery : true,
              displayField : 'name',
              editable : true,
              emptyText : _this._strings['addf678354e22ee4f52fefb5f25069d1'] /* Select Client */,
              fieldLabel : _this._strings['577d7068826de925ea2aec01dbadf5e4'] /* Client */,
              forceSelection : true,
              hiddenName : 'client_id',
              listWidth : 400,
              loadingText : _this._strings['1243daf593fa297e07ab03bf06d925af'] /* Searching... */,
              minChars : 2,
              name : 'client_id_name',
              pageSize : 20,
              qtip : _this._strings['addf678354e22ee4f52fefb5f25069d1'] /* Select Client */,
              queryParam : 'query[name]',
              selectOnFocus : true,
              tpl : '<div class=\"x-grid-cell-text x-btn button\"><b>{name}</b> </div>',
              triggerAction : 'all',
              typeAhead : false,
              valueField : 'id',
              width : 300,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'ComboBox',
              listeners : {
               add : function (combo)
                {
                    Pman.Dialog.Companies.show({},
                        function (data) {
                            _this.form.setValues({
                                client_id_name : data.name,
                                client_id : data.id
                            });
                        
                        }
                    );
                }
              },
              store : {
               remoteSort : true,
               sortInfo : { field: 'name', direction: 'ASC' },
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'Store',
               listeners : {
                beforeload : function (_self, o){
                     o.params = o.params || {};
                     // set more here
                      o.params['comptype[0]'] = 'CLIENT';
                    o.params['comptype[1]'] = 'AGENCY';
                 }
               },
               proxy : {
                method : 'GET',
                url : baseURL + '/Roo/Companies.php',
                xns : Roo.data,
                '|xns' : 'Roo.data',
                xtype : 'HttpProxy'
               },
               reader : {
                fields : [
                    {
                        'name': 'code',
                        'type': 'string'
                    },
                    {
                        'name': 'name',
                        'type': 'string'
                    },
                    {
                        'name': 'remarks',
                        'type': 'string'
                    },
                    {
                        'name': 'owner_id',
                        'type': 'int'
                    },
                    {
                        'name': 'address',
                        'type': 'string'
                    },
                    {
                        'name': 'tel',
                        'type': 'string'
                    },
                    {
                        'name': 'fax',
                        'type': 'string'
                    },
                    {
                        'name': 'email',
                        'type': 'string'
                    },
                    {
                        'name': 'id',
                        'type': 'int'
                    },
                    {
                        'name': 'isOwner',
                        'type': 'int'
                    },
                    {
                        'name': 'logo_id',
                        'type': 'int'
                    },
                    {
                        'name': 'background_color',
                        'type': 'string'
                    },
                    {
                        'name': 'comptype',
                        'type': 'string'
                    },
                    {
                        'name': 'ava_craft',
                        'type': 'string'
                    },
                    {
                        'name': 'url',
                        'type': 'string'
                    },
                    {
                        'name': 'main_office_id',
                        'type': 'int'
                    },
                    {
                        'name': 'created_by',
                        'type': 'int'
                    },
                    {
                        'name': 'created_dt',
                        'type': 'string'
                    },
                    {
                        'name': 'updated_by',
                        'type': 'int'
                    },
                    {
                        'name': 'updated_dt',
                        'type': 'string'
                    },
                    {
                        'name': 'passwd',
                        'type': 'string'
                    }
                ],
                id : 'id',
                root : 'data',
                totalProperty : 'total',
                xns : Roo.data,
                '|xns' : 'Roo.data',
                xtype : 'JsonReader'
               }
              }
             },
             {
              fieldLabel : _this._strings['9c715f0e523e7e1d00d538db7b78615b'] /* Word count */,
              name : 'word_count',
              readOnly : true,
              width : 50,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'NumberField'
             },
             {
              hideLabels : true,
              labelWidth : 0,
              style : 'overflow:hidden',
              width : 150,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'Row',
              items  : [
               {
                boxLabel : 'Distribute To Feed',
                name : 'distribute_to_feed',
                value : 1,
                valueOff : 0,
                width : 150,
                xns : Roo.form,
                '|xns' : 'Roo.form',
                xtype : 'Checkbox'
               }
              ]
             }
            ]
           },
           {
            labelWidth : 75,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'Row',
            items  : [
             {
              allowBlank : false,
              displayField : 'title',
              editable : false,
              fieldLabel : _this._strings['4994a8ffeba4ac3140beb89e8d41f174'] /* Language */,
              hiddenName : 'language',
              listWidth : 200,
              mode : 'local',
              name : 'language_name',
              tpl : '<div class=\"x-grid-cell-text x-btn button\"><b>{title}</b> </div>',
              triggerAction : 'all',
              valueField : 'code',
              width : 200,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'ComboBox',
              store : {
               data : (function() {return typeof(Pman) == 'object'  ? Pman.I18n.simpleStoreData('l') : []})(),
               fields : ['code', 'title'],
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'SimpleStore'
              }
             },
             {
              allowBlank : false,
              displayField : 'title',
              editable : false,
              fieldLabel : _this._strings['59716c97497eb9694541f7c3d37b1a4d'] /* Country */,
              hiddenName : 'country',
              listWidth : 200,
              mode : 'local',
              name : 'country_name',
              tpl : '<div class=\"x-grid-cell-text x-btn button\"><b>{title}</b> </div>',
              triggerAction : 'all',
              valueField : 'code',
              width : 200,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'ComboBox',
              store : {
               data : (function() {return typeof(Pman) == 'object'  ? Pman.I18n.simpleStoreData('c') : []})(),
               fields : ['code', 'title'],
               sortInfo : { field : 'title', direction: 'ASC' },
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'SimpleStore'
              }
             }
            ]
           },
           {
            labelWidth : 75,
            width : 730,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'Row',
            items  : [
             {
              allowBlank : true,
              fieldLabel : _this._strings['110a4b01beabd53b661a47d4b44bd7a8'] /* Publish */,
              format : 'Y-m-d',
              name : 'publish_dt_day',
              width : 100,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'DateField'
             },
             {
              allowBlank : false,
              displayField : 'hr',
              editable : false,
              fieldLabel : _this._strings['a76d4ef5f3f6a672bbfab2865563e530'] /* Time */,
              listWidth : 80,
              mode : 'local',
              name : 'publish_dt_hr',
              triggerAction : 'all',
              valueField : 'hr',
              width : 60,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'ComboBox',
              store : {
               data : (function() {
                  var r = [];
                  for (var i =0;i < 24;i++) {
                     r.push( [ i + ':00']);
                     r.push([ i + ':30']);
                  }
                  return r;
               })(),
               fields : [  'hr'],
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'SimpleStore'
              }
             },
             {
              allowBlank : false,
              displayField : 'fname',
              editable : false,
              fieldLabel : _this._strings['236df51bb0e6416236e255b528346fca'] /* Timezone */,
              hiddenName : 'publish_dt_tz',
              listWidth : 500,
              mode : 'local',
              name : 'publish_dt_tz_name',
              triggerAction : 'all',
              valueField : 'ftype',
              width : 280,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'ComboBox',
              store : {
               data : [
                        ['-12.00' ,  '(GMT -12:00) Eniwetok, Kwajalein'],
                        ['-11.00' ,  '(GMT -11:00) Midway Island, Samoa'],
                        ['-10.00' ,  '(GMT -10:00) Hawaii'],
                        ['-9.00' ,  '(GMT -9:00) Alaska'],
                        ['-8.00' ,  '(GMT -8:00) Pacific Time (US & Canada)'],
                        ['-7.00' ,  '(GMT -7:00) Mountain Time (US & Canada)'],
                        ['-6.00' ,  '(GMT -6:00) Central Time (US & Canada), Mexico City'],
                        ['-5.00' ,  '(GMT -5:00) Eastern Time (US & Canada), Bogota, Lima'],
                        ['-4.00' ,  '(GMT -4:00) Atlantic Time (Canada), Caracas, La Paz'],
                        ['-3.50' ,  '(GMT -3:30) Newfoundland'],
                        ['-3.00' ,  '(GMT -3:00) Brazil, Buenos Aires, Georgetown'],
                        ['-2.00' ,  '(GMT -2:00) Mid-Atlantic'],
                        ['-1.00' ,  '(GMT -1:00 hour) Azores, Cape Verde Islands'],
                        ['0.00' ,  '(GMT) Western Europe Time, London, Lisbon, Casablanca'],
                        ['1.00' ,  '(GMT +1:00 hour) Brussels, Copenhagen, Madrid, Paris'],
                        ['2.00' ,  '(GMT +2:00) Kaliningrad, South Africa'],
                        ['3.00' ,  '(GMT +3:00) Baghdad, Riyadh, Moscow, St. Petersburg'],
                        ['3.30' ,  '(GMT +3:30) Tehran'],
                        ['4.00' , '(GMT +4:00) Abu Dhabi, Muscat, Baku, Tbilisi'],
                        ['4.50' , '(GMT +4:30) Kabul'],
                        ['5.00' , '(GMT +5:00) Ekaterinburg, Islamabad, Karachi, Tashkent'],
                        ['5.30' ,  '(GMT +5:30) Bombay, Calcutta, Madras, New Delhi'],
                        ['5.45' ,  '(GMT +5:45) Kathmandu'],
                        ['6.00' ,  '(GMT +6:00) Almaty, Dhaka, Colombo'],
                        ['7.00' ,  '(GMT +7:00) Bangkok, Hanoi, Jakarta'],
                        ['8.00' ,  '(GMT +8:00) Beijing, Perth, Singapore, Hong Kong'],
                        ['9.00' ,  '(GMT +9:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk'],
                        ['9.30' ,  '(GMT +9:30) Adelaide, Darwin'],
                        ['10.00' ,  '(GMT +10:00) Eastern Australia, Guam, Vladivostok'],
                        ['11.00' ,  '(GMT +11:00) Magadan, Solomon Islands, New Caledonia'],
                        ['12.00' ,  '(GMT +12:00) Auckland, Wellington, Fiji, Kamchatka']
                       ],
               fields : [  'ftype', 'fname' ],
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'SimpleStore'
              }
             }
            ]
           }
          ]
         },
         {
          width : 750,
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Column',
          items  : [
           {
            allowBlank : false,
            fieldLabel : _this._strings['c6568e77f61109390e82d035aaacaef0'] /* Headline */,
            name : 'headline',
            width : 650,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'TextField'
           },
           {
            fieldLabel : _this._strings['b1515c8965e8b24b15046bb2afe27123'] /* Sub-Headline */,
            name : 'subheadline',
            width : 650,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'TextField'
           }
          ]
         },
         {
          labelAlign : 'top',
          width : 760,
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Row',
          items  : [
           {
            allowBlank : false,
            cblack : [ 'font-size' ],
            fieldLabel : _this._strings['f15c1cae7882448b3fb0404682e17e61'] /* Content */,
            height : 230,
            name : 'content',
            resizable : 's',
            stylesheets : [ 
               rootURL + '/Pman/PressRelease/templates/images/css/press.release.preview.css'
            ],
            width : 750,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'HtmlEditor',
            listeners : {
             sync : function (_self, html)
              {
                  Roo.log('sync');
                  var lab =  this.fieldEl.query('label')[0];
                  var it = this.editorcore.doc.body.innerText || this.editorcore.doc.body.textContent;
                  var n = Math.max(0, it.replace(/^\s+/, '').replace(/\s+$/, '').split(/\s+/).length );
                  
                  lab.innerHTML = 'Content: (' + n + ' Words)';
                  _this.form.updateWordCount();
              }
            },
            toolbars : [
             {
              xns : Roo.form.HtmlEditor,
              '|xns' : 'Roo.form.HtmlEditor',
              xtype : 'ToolbarStandard',
              btns : [
               {
                alwaysQuery : true,
                displayField : 'name',
                editable : false,
                emptyText : _this._strings['446a6000511ab6fb0711400379a62a04'] /* Select Image */,
                fieldLabel : _this._strings['fff0d600f8a0b5e19e88bfb821dd1157'] /* Images */,
                forceSelection : true,
                listWidth : 400,
                loadingText : _this._strings['1243daf593fa297e07ab03bf06d925af'] /* Searching... */,
                minChars : 2,
                pageSize : 20,
                qtip : _this._strings['2f26e35d61be90501e099089dc533638'] /* Select Images */,
                queryParam : 'search',
                selectOnFocus : true,
                tpl : '<div class=\"x-grid-cell-text x-btn button\"><img src=\"{url_thumb}\" height=\"150\" width=\"150\"><b>{filename}</b> </div>',
                triggerAction : 'all',
                typeAhead : true,
                valueField : 'id',
                width : 100,
                xns : Roo.form,
                '|xns' : 'Roo.form',
                xtype : 'ComboBox',
                listeners : {
                 beforequery : function (combo, query, forceAll, cancel, e)
                  {
                   
                      var id = _this.form.findField('id').getValue() * 1;    
                      if (!id) {
                          Roo.MessageBox.alert("Error", "Save press release first");
                          return false;
                      }
                  },
                 render : function (_self)
                  {
                      _this.bodyimgselect = _self;
                  },
                 select : function (combo, record, index)
                  {
                      Roo.log(record);
                      (function() { 
                          combo.setValue('');
                      }).defer(100);
                  
                      var editor = _this.form.findField('content').editorcore;
                      
                      var curnode = editor.getSelectedNode();
                  
                      if (curnode && curnode.tagName == 'IMG') {
                          curnode.src= String.format('{0}/Images/{1}/{2}#image-{1}',
                                  baseURL,  record.data.id, record.data.filename
                              );
                              // note -forces an update... hopefully...
                          editor.owner.fireEvent('editorevent', editor, false);
                      } else {
                      
                          editor.insertAtCursor(
                              String.format('<img src="{0}/Images/{1}/{2}#image-{1}">',
                              baseURL,  record.data.id, record.data.filename
                              )
                          );
                  
                      }
                      
                  }
                },
                store : {
                 remoteSort : true,
                 sortInfo : { direction : 'ASC', field: 'id' },
                 xns : Roo.data,
                 '|xns' : 'Roo.data',
                 xtype : 'Store',
                 listeners : {
                  beforeload : function (_self, o){
                       o.params = o.params || {};
                   
                       var id = _this.form.findField('id').getValue() * 1;    
                       if (!id) {
                           Roo.MessageBox.alert("Error", "Save press release first");
                           return false;
                       }
                       o.params.onid = id
                       o.params.ontable = 'pressrelease_entry';
                      // o.params.imgtype = 'PressRelease';
                       o.params['query[imagesize]'] = '150x150';
                       // set more here
                   }
                 },
                 proxy : {
                  method : 'GET',
                  url : baseURL + '/Roo/Images.php',
                  xns : Roo.data,
                  '|xns' : 'Roo.data',
                  xtype : 'HttpProxy'
                 },
                 reader : {
                  fields : [{"name":"id","type":"int"},{"name":"filename","type":"string"},{"name":"url_thumb","type":"string"}],
                  id : 'id',
                  root : 'data',
                  totalProperty : 'total',
                  xns : Roo.data,
                  '|xns' : 'Roo.data',
                  xtype : 'JsonReader'
                 }
                }
               }
              ]
             },
             {
              xns : Roo.form.HtmlEditor,
              '|xns' : 'Roo.form.HtmlEditor',
              xtype : 'ToolbarContext'
             }
            ]
           }
          ]
         },
         {
          name : 'distribution_config',
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Hidden'
         },
         {
          name : 'distribution_countries',
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Hidden'
         },
         {
          name : 'blacklist_ids',
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Hidden'
         },
         {
          name : 'project_id',
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Hidden'
         },
         {
          name : 'parent_id_project_id',
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Hidden'
         },
         {
          name : 'id',
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Hidden'
         }
        ]
       }
      ]
     },
     {
      background : true,
      region : 'center',
      title : _this._strings['dc9227804a61468a485e682cb932bdf7'] /* Company Details */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'ContentPanel',
      items  : [
       {
        labelWidth : 80,
        method : 'POST',
        style : 'margin:10px;',
        url : baseURL + '/Roo/Companies.php',
        xns : Roo.form,
        '|xns' : 'Roo.form',
        xtype : 'Form',
        listeners : {
         rendered : function (form)
          {
              _this.form2= form;
          }
        },
        items  : [
         {
          labelWidth : 80,
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Row',
          items  : [
           {
            fieldLabel : _this._strings['d171235ac80dfa3cd3c83d27312565e5'] /* Stock Code */,
            name : 'stockcode',
            width : 100,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'TextField'
           },
           {
            labelWidth : 110,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'Row',
            items  : [
             {
              fieldLabel : _this._strings['b9dc4c481b230aaec437ef58b23ca1ef'] /*  (Chinese) Name */,
              name : 'company_name_alt',
              width : 150,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'TextField'
             }
            ]
           }
          ]
         },
         {
          labelWidth : 80,
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Row',
          items  : [
           {
            allowBlank : true,
            displayField : 'name',
            editable : false,
            emptyText : _this._strings['cbe695bf80e8066f16a941601cd6846b'] /* Select exchange */,
            fieldLabel : _this._strings['992374d8e2e24f17bebc50a6e57becd6'] /* Exchange */,
            forceSelection : true,
            hiddenName : 'stock_exchange_id',
            listWidth : 400,
            loadingText : _this._strings['1243daf593fa297e07ab03bf06d925af'] /* Searching... */,
            minChars : 2,
            name : 'stock_exchange_id_name',
            pageSize : 20,
            qtip : _this._strings['df1390c4238324679161da9c6652d17a'] /* Select Exchange */,
            queryParam : 'query[name]',
            selectOnFocus : true,
            tpl : '<div class=\"x-grid-cell-text x-btn button\"><b>{name}</b> </div>',
            triggerAction : 'all',
            typeAhead : true,
            valueField : 'id',
            width : 100,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'ComboBox',
            store : {
             remoteSort : true,
             sortInfo : { direction : 'ASC', field: 'id' },
             xns : Roo.data,
             '|xns' : 'Roo.data',
             xtype : 'Store',
             listeners : {
              beforeload : function (_self, o){
                   o.params = o.params || {};
                   // set more here
                   o.params.etype='Exchange';
               }
             },
             proxy : {
              method : 'GET',
              url : baseURL + '/Roo/core_enum.php',
              xns : Roo.data,
              '|xns' : 'Roo.data',
              xtype : 'HttpProxy'
             },
             reader : {
              fields : [{"name":"id","type":"int"},{"name":"etype","type":"string"}],
              id : 'id',
              root : 'data',
              totalProperty : 'total',
              xns : Roo.data,
              '|xns' : 'Roo.data',
              xtype : 'JsonReader'
             }
            }
           },
           {
            labelWidth : 70,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'Row',
            items  : [
             {
              fieldLabel : _this._strings['f31bbdd1b3e85bccd652680e16935819'] /* Source */,
              name : 'source_name',
              width : 300,
              xns : Roo.form,
              '|xns' : 'Roo.form',
              xtype : 'TextField'
             }
            ]
           }
          ]
         },
         {
          labelAlign : 'top',
          width : 800,
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'Column',
          items  : [
           {
            fieldLabel : _this._strings['9aa698f602b1e5694855cee73a683488'] /* Contacts */,
            height : 100,
            name : 'contact_txt',
            width : 750,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'TextArea'
           },
           {
            fieldLabel : _this._strings['47bd5f0bae18a1ce015e40d73a33a15f'] /* Company Boiler Plate Statement */,
            height : 150,
            name : 'content_about',
            width : 750,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'TextArea'
           },
           {
            fieldLabel : _this._strings['c00adc22f2bb333883dc1723e2899a0c'] /* Related Web Links <B>Must have http:// before the link</b> */,
            height : 100,
            name : 'content_links',
            width : 750,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'TextArea'
           }
          ]
         }
        ]
       }
      ]
     },
     {
      region : 'center',
      title : _this._strings['3f0f4d7d0b92612398cc55d9e47965e2'] /* Financial Data */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'NestedLayoutPanel',
      listeners : {
       activate : function (_self)
        {
           //console.log('activate');
           if (_this.hasFinanceWatch) {
             return;
           }
           _this.hasFinanceWatch =true;
           _this.financeSending =false;
             window.setInterval( function() {
                // stops warning in editor..
                if (!_this.financeForm) {
                    return;
                }
                var val = _this.financeForm.findField('imageUpload').getValue();
                if (!val || !val.length) {
                    return;
                }
                
                if (_this.financeSending) {
                    return;
                }
                 _this.financeSending =true;
                 
                _this.financeForm.el.mask("Sending");
                _this.financeForm.submit.defer(100, _this.financeForm);
           
          }, 1000)  
           
        }
      },
      layout : {
       xns : Roo,
       '|xns' : 'Roo',
       xtype : 'BorderLayout',
       center : {
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'LayoutRegion'
       },
       south : {
        height : 40,
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'LayoutRegion'
       },
       items  : [
        {
         fitContainer : true,
         fitToFrame : true,
         region : 'center',
         xns : Roo,
         '|xns' : 'Roo',
         xtype : 'ContentPanel',
         items  : [
          {
           method : 'POST',
           style : 'margin:10px;',
           url : baseURL + '/Roo/pressrelease_entry.php',
           xns : Roo.form,
           '|xns' : 'Roo.form',
           xtype : 'Form',
           listeners : {
            rendered : function (form)
             {
                 _this.form3= form;
             }
           },
           items  : [
            {
             labelAlign : 'top',
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'Row',
             items  : [
              {
               fieldLabel : _this._strings['20e9dc20a361244eb40c7b723a393995'] /* Forward Looking Statement */,
               height : 150,
               name : 'content_forward',
               width : 750,
               xns : Roo.form,
               '|xns' : 'Roo.form',
               xtype : 'TextArea'
              },
              {
               fieldLabel : _this._strings['432c508d90a57863d3800a123fdefa23'] /* Financial Content */,
               height : 200,
               name : 'content_data',
               resizable : 's',
               style : 'font-family: monospace;',
               stylesheets : [ 
                  rootURL + '/Pman/PressRelease/templates/images/css/press.release.preview.css'
                 
               ],
               width : 750,
               xns : Roo.form,
               '|xns' : 'Roo.form',
               xtype : 'HtmlEditor',
               toolbars : [
                {
                 xns : Roo.form.HtmlEditor,
                 '|xns' : 'Roo.form.HtmlEditor',
                 xtype : 'ToolbarStandard'
                },
                {
                 styles : { 
                    'TD' :  [ 'underline', 'double-underline' ]
                 },
                 xns : Roo.form.HtmlEditor,
                 '|xns' : 'Roo.form.HtmlEditor',
                 xtype : 'ToolbarContext'
                }
               ]
              }
             ]
            }
           ]
          }
         ]
        },
        {
         region : 'south',
         xns : Roo,
         '|xns' : 'Roo',
         xtype : 'ContentPanel',
         items  : [
          {
           fileUpload : true,
           labelWidth : 200,
           style : 'margin: 10px;',
           url : baseURL + '/PressRelease/ExcelToText.php',
           xns : Roo.form,
           '|xns' : 'Roo.form',
           xtype : 'Form',
           listeners : {
            actioncomplete : function (_self, action)
             {
             // only action this will handle is submit?
             // should test for errors..
                 if (action.failureType) {
                       _this.financeForm.el.unmask();
                       _this.uploadSending = false;
                     Roo.MessageBox.alert("Error", "Upload Failed");
                     return false;
                 
                 }
                   
                 
                 if (action.type =='submit') {
                      _this.financeForm.reset();
                        _this.financeSending = false;
                       _this.financeForm.el.unmask();         
                     _this.form3.findField('content_data').setValue(action.result.data);
             
                      return;
                 }
                  
             },
            rendered : function (form)
             {
               _this.financeForm = form;
             }
           },
           items  : [
            {
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'Row',
             items  : [
              {
               allowBlank : false,
               fieldLabel : _this._strings['ad5fd38e083fd0d559ca3f54fa7ed593'] /* Upload Excel of Financial data */,
               inputType : 'file',
               name : 'imageUpload',
               width : 350,
               xns : Roo.form,
               '|xns' : 'Roo.form',
               xtype : 'TextField'
              }
             ]
            }
           ]
          }
         ]
        }
       ]
      }
     },
     {
      region : 'center',
      title : _this._strings['11f7b456ca765e9f556f653090045ae7'] /* Images / PDF */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'NestedLayoutPanel',
      listeners : {
       activate : function (_self)
        {
           _this.imagePanel = _self;
           if (_this.addFromStore) {
               _this.addFromStore.lastQuery = '~~~~';
           }
        
        
           
           
        //   console.log('activate');
           if (!_this.loaded) {
             return;
           }
           _this.imageView.el.unmask();
           if (_this.data.id) {
               _this.imageView.loadImages();
           } else {
              _this.imageView.el.mask("Save Press Release First");
           }
           
           if (_this.hasUploadWatch) {
             return;
           }
            _this.hasUploadWatch =true;
            _this.uploadSending =false;
            window.setInterval( function() {
                // prevent warning in editor..
                if (!_this.uploadForm) {return; }
                
              
                
                var val = _this.uploadForm.findField('imageUpload').getValue();
                if (!val || !val.length) {
                    return;
                }
                 var id = _this.form.findField('id').getValue() * 1;    
                if (!id) {
                    Roo.MessageBox.alert("Error", "Save press release first");
                   _this.uploadForm.reset();
                    return;
                }
                if (_this.uploadSending) {
                    return;
                }
                 _this.uploadSending =true;
                _this.uploadForm.findField('onid').setValue(_this.data.id);
                _this.uploadForm.el.mask("Sending");
                _this.uploadForm.submit.defer(100, _this.uploadForm);
           
          }, 1000)  
           
        }
      },
      layout : {
       xns : Roo,
       '|xns' : 'Roo',
       xtype : 'BorderLayout',
       center : {
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'LayoutRegion'
       },
       east : {
        hidden : true,
        width : 200,
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'LayoutRegion'
       },
       south : {
        height : 60,
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'LayoutRegion'
       },
       items  : [
        {
         autoScroll : true,
         fitContainer : true,
         fitToFrame : true,
         region : 'center',
         xns : Roo,
         '|xns' : 'Roo',
         xtype : 'ContentPanel',
         toolbar : {
          xns : Roo,
          '|xns' : 'Roo',
          xtype : 'Toolbar',
          items  : [
           {
            text : _this._strings['01a5bf98dc3a43bb2f6d0787d87030b7'] /* Add From Image Store */,
            xns : Roo.Toolbar,
            '|xns' : 'Roo.Toolbar',
            xtype : 'TextItem'
           },
           {
            alwaysQuery : true,
            displayField : 'name',
            editable : false,
            emptyText : _this._strings['446a6000511ab6fb0711400379a62a04'] /* Select Image */,
            fieldLabel : _this._strings['fff0d600f8a0b5e19e88bfb821dd1157'] /* Images */,
            forceSelection : true,
            listWidth : 400,
            loadingText : _this._strings['1243daf593fa297e07ab03bf06d925af'] /* Searching... */,
            minChars : 2,
            pageSize : 20,
            qtip : _this._strings['2f26e35d61be90501e099089dc533638'] /* Select Images */,
            queryParam : 'search',
            selectOnFocus : true,
            tpl : '<div class=\"x-grid-cell-text x-btn button\"><img src=\"{url_thumb}\" height=\"150\" width=\"150\"><b>{filename}</b> </div>',
            triggerAction : 'all',
            typeAhead : true,
            valueField : 'id',
            width : 300,
            xns : Roo.form,
            '|xns' : 'Roo.form',
            xtype : 'ComboBox',
            listeners : {
             beforequery : function (combo, query, forceAll, cancel, e)
              {
              var c = _this.form.findField('client_id').getValue();
                  if (!c) {
                      Roo.MessageBox.alert("Error", "Select a company first");
                      return false;
                  }
                  var id = _this.form.findField('id').getValue() * 1;    
                  if (!id) {
                      Roo.MessageBox.alert("Error", "Save press release first");
                      return false;
                  }
              },
             render : function (_self)
              {
                  _this.addFromStore = _self;
              },
             select : function (combo, record, index)
              {
                  Roo.log(record);
                  new Pman.Request({
                      url: baseURL + '/Roo/Images',
                      method : 'POST',
                      params : {
                          ontable : 'pressrelease_entry',
                          onid : _this.form.findField('id').getValue(),
                          _copy_from : record.data.id
                      }, 
                      success : function()
                      {
                          _this.imageView.loadImages();
                      }
                  });   
              }
            },
            store : {
             remoteSort : true,
             sortInfo : { direction : 'ASC', field: 'id' },
             xns : Roo.data,
             '|xns' : 'Roo.data',
             xtype : 'Store',
             listeners : {
              beforeload : function (_self, o){
                   o.params = o.params || {};
                   var c = _this.form.findField('client_id').getValue();
                   if (!c) {
                       Roo.MessageBox.alert("Error", "Select a company first");
                       return false;
                   }
                   var id = _this.form.findField('id').getValue() * 1;    
                   if (!id) {
                       Roo.MessageBox.alert("Error", "Save press release first");
                       return false;
                   }
                   o.params.onid = c;
                   o.params.ontable = 'Companies';
                  // o.params.imgtype = 'PressRelease';
                   o.params['query[imagesize]'] = '150x150';
                   // set more here
               }
             },
             proxy : {
              method : 'GET',
              url : baseURL + '/Roo/Images.php',
              xns : Roo.data,
              '|xns' : 'Roo.data',
              xtype : 'HttpProxy'
             },
             reader : {
              fields : [{"name":"id","type":"int"},{"name":"filename","type":"string"},{"name":"url_thumb","type":"string"}],
              id : 'id',
              root : 'data',
              totalProperty : 'total',
              xns : Roo.data,
              '|xns' : 'Roo.data',
              xtype : 'JsonReader'
             }
            }
           },
           {
            xns : Roo.Toolbar,
            '|xns' : 'Roo.Toolbar',
            xtype : 'Fill'
           },
           {
            text : _this._strings['c9d03748d1a54666b5c7a5187109301b'] /* Delete Selected File or  Image */,
            xns : Roo.Toolbar,
            '|xns' : 'Roo.Toolbar',
            xtype : 'Button',
            listeners : {
             click : function (_self, e)
              {
                  if (!_this.imageView.getSelectedNodes().length) {
                   Roo.MessageBox.alert("Error", "Select an Image");
                   return;
                 }
                 var id  = _this.imageView.getNodeData(_this.imageView.getSelectedNodes()[0]).id;
                 _this.imageView.el.mask('Deleting');
                 
                 Roo.Ajax.request({
                    url : baseURL + '/Roo/Images.php',
                    params : {
                       _delete : id
                    },
                    method : 'POST',
                    success : function() {
                        _this.imageView.loadImages();
                    },
                    failure : function() {
                         _this.imageView.el.unmask();
                         Roo.MessageBox.alert("Error", "Error deleting image");
                         return;
                    }
                });
               }
            }
           }
          ]
         },
         items  : [
          {
           jsonRoot : 'data',
           loadImages : function() {
                this.load({
                   url : baseURL + '/Roo/Images.php',
                   method : 'GET',
                   params : {
                      ontable : 'pressrelease_entry',
                      onid : _this.data.id,
                      'query[imagesize]' : '150x150',
                      'query[imageBaseURL]' : rootURL + '/release.php'
                   },
                   text : 'Loading'
              });
              
           },
           singleSelect : true,
           xns : Roo,
           '|xns' : 'Roo',
           xtype : 'JsonView',
           listeners : {
            beforerender : function (_self, data)
             {
                _this.imageView = _self;
                
                if (this.stylesheet) {
                   return;
                }
                this.el.addClass('thumb-browser');
             
                
                this.stylesheet = Roo.util.CSS.createStyleSheet(
                     {
                       '.thumb-browser .thumb-wrap' : {
                             border:'3px solid #EEE',
                             'float':'left',
                             height:'190px',
                             margin:'2px',
                             'padding-left':'5px',
                             'padding-top':'5px',
                             width:'160px'
                         },
                         '.thumb-browser .x-view-selected' : {
                           border:'3px solid #333'
                       
                         },
                         '.thumblabel' : {
                             font: 'normal normal normal 11px/normal tahoma, verdana, helvetica'
                         }
             
                     }, Roo.id()
                     );
                
             },
            selectionchange : function (_self, selections)
             {
                  
                  var snode = false;
                  if (selections && selections.length) {
                     try {
                        var snode =  _this.imageView.getNodeData(selections[0]);
                     } catch (e) {}
                 }
                  
                 if (!snode) {
                      _this.imagePanel.layout.getRegion('east').hide();
                     return;
                 }
                 _this.imagePanel.layout.getRegion('east').show();    
              
                 _this.imageForm.setValues(snode);
             }
           },
           tpl : {
            html : '<div class="thumb-wrap"> ' + 
              '<div class="thumb"><img  src="{url_thumb}" class="thumb-img"></div>' + 
              '<div class="thumblabel">{title}<br/>{linkurl}</div>' + 
            '</div>',
            xns : Roo,
            '|xns' : 'Roo',
            xtype : 'Template'
           }
          }
         ]
        },
        {
         region : 'south',
         xns : Roo,
         '|xns' : 'Roo',
         xtype : 'ContentPanel',
         items  : [
          {
           fileUpload : true,
           labelWidth : 200,
           progressUrl : baseURL  + '/Core/UploadProgress.php',
           style : 'margin: 10px;',
           url : baseURL + '/Roo/Images.php',
           xns : Roo.form,
           '|xns' : 'Roo.form',
           xtype : 'Form',
           listeners : {
            actioncomplete : function (_self, action)
             {
             // only action this will handle is submit?
             // should test for errors..
                 if (action.failureType) {
                     _this.uploadForm.el.unmask();
                     _this.uploadSending = false;
                     Roo.MessageBox.alert("Error", "Upload Failed");
                     return false;
                 
                 }
                   
                 
                 if (action.type =='submit') {
                      _this.uploadForm.reset();
                        _this.uploadSending = false;
                       _this.uploadForm.el.unmask();         
                       _this.imageView.loadImages();
                      return;
                 }
                  
             },
            actionfailed : function (_self, action)
             {
             
                _this.uploadForm.el.unmask();
                _this.uploadForm.reset();
                 _this.uploadSending = false;
                 Roo.MessageBox.alert("Error", "Upload Failed");
                 _this.imageView.loadImages();
                 
               
             },
            rendered : function (form)
             {
               _this.uploadForm = form;
             }
           },
           items  : [
            {
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'Row',
             items  : [
              {
               allowBlank : false,
               fieldLabel : _this._strings['ea72bacd2fdfa818907bb9559e6905a1'] /* Upload Image or File */,
               inputType : 'file',
               name : 'imageUpload',
               width : 250,
               xns : Roo.form,
               '|xns' : 'Roo.form',
               xtype : 'TextField'
              }
             ]
            },
            {
             name : 'onid',
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'Hidden'
            },
            {
             name : 'ontable',
             value : _this._strings['95291adff6df977dbba485210bcf6b3c'] /* pressrelease_entry */,
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'Hidden'
            }
           ]
          }
         ]
        },
        {
         region : 'east',
         xns : Roo,
         '|xns' : 'Roo',
         xtype : 'ContentPanel',
         items  : [
          {
           labelAlign : 'top',
           method : 'POST',
           style : 'margin:10px;',
           url : baseURL + '/Roo/Images.php',
           xns : Roo.form,
           '|xns' : 'Roo.form',
           xtype : 'Form',
           listeners : {
            actioncomplete : function(_self,action)
             {
                 if (action.type == 'setdata') {
                    //_this.dialog.el.mask("Loading");
                    //this.load({ method: 'GET', params: { '_id' : _this.data.id }});
                    return;
                 }
                 if (action.type == 'load') {
             
                     return;
                 }
                 if (action.type =='submit') {
                      _this.selectAfterLoad = this.findField('id').getValue();
                        var lr =  _this.imagePanel.layout.getRegion('east');
                     lr.el.unmask();
                     _this.imageView.loadImages();
                      return;
                 }
             },
            actionfailed : function (_self, action)
             {
                     var lr =  _this.imagePanel.layout.getRegion('east');
                     lr.el.unmask();
                if (action.failureType ==  Roo.form.Action.CLIENT_INVALID) {
                 Roo.MessageBox.alert("Error", "Correct All the errors in Red");
                 return;
                }
                 Roo.MessageBox.alert("Error", "Problem sending to server");
             },
            rendered : function (form)
             {
                 _this.imageForm= form;
             }
           },
           items  : [
            {
             fieldLabel : _this._strings['b78a3223503896721cca1303f776159b'] /* Title */,
             height : 50,
             name : 'title',
             width : 150,
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'TextArea'
            },
            {
             fieldLabel : _this._strings['90e02e896b4ee833a24236b45060d175'] /* Description / Byline */,
             height : 75,
             name : 'descript',
             width : 150,
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'TextArea'
            },
            {
             alwaysQuery : true,
             displayField : 'name',
             editable : false,
             emptyText : _this._strings['8535bcc0f05358a583bb432bbadf7e0d'] /* Select type */,
             fieldLabel : _this._strings['8e16a71b3d8217eb80b39b7d8dec4296'] /* Image Type */,
             forceSelection : true,
             listWidth : 200,
             loadingText : _this._strings['1243daf593fa297e07ab03bf06d925af'] /* Searching... */,
             minChars : 2,
             name : 'imgtype',
             pageSize : 20,
             qtip : _this._strings['471ddaf9e80da04dd5a3a54daa0239b0'] /* Select Image Type */,
             queryParam : 'query[name]',
             selectOnFocus : true,
             tpl : '<div class=\"x-grid-cell-text x-btn button\"><b>{name}</b> </div>',
             triggerAction : 'all',
             typeAhead : true,
             valueField : 'name',
             width : 150,
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'ComboBox',
             store : {
              remoteSort : true,
              sortInfo : { direction : 'ASC', field: 'id' },
              xns : Roo.data,
              '|xns' : 'Roo.data',
              xtype : 'Store',
              listeners : {
               beforeload : function (_self, o){
                    o.params = o.params || {};
                    // set more here
                       // set more here
                    o.params.etype="Image Types";
                }
              },
              proxy : {
               method : 'GET',
               url : baseURL + '/Roo/core_enum.php',
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'HttpProxy'
              },
              reader : {
               fields : [{"name":"id","type":"int"},{"name":"name","type":"string"}],
               id : 'id',
               root : 'data',
               totalProperty : 'total',
               xns : Roo.data,
               '|xns' : 'Roo.data',
               xtype : 'JsonReader'
              }
             }
            },
            {
             fieldLabel : _this._strings['97e7c9a7d06eac006a28bf05467fcc8b'] /* Link */,
             name : 'linkurl',
             vtype : 'url',
             width : 150,
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'TextField'
            },
            {
             fieldLabel : _this._strings['0a90b1bc4078f74b6f0d117ec7df65af'] /* Credit */,
             name : 'credit',
             width : 150,
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'TextField'
            },
            {
             fieldLabel : _this._strings['f31bbdd1b3e85bccd652680e16935819'] /* Source */,
             name : 'source',
             width : 150,
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'TextField'
            },
            {
             fieldLabel : _this._strings['529701d5ccccf8a1c604c27f48ce7d82'] /* Mimetype */,
             name : 'mimetype',
             readOnly : true,
             width : 150,
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'TextField'
            },
            {
             fieldLabel : _this._strings['b18c29b8470190a02813415a04a2191f'] /* Filesize */,
             name : 'filesize',
             readOnly : true,
             width : 75,
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'TextField'
            },
            {
             name : 'id',
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'Hidden'
            },
            {
             text : _this._strings['55cfeeacad2f92b9fea0a1bbb6449fac'] /* Update Image Details */,
             xns : Roo,
             '|xns' : 'Roo',
             xtype : 'Button',
             listeners : {
              click : function (_self, e)
               {
               
                   var lr =  _this.imagePanel.layout.getRegion('east');
                   lr.el.mask("Saving");
                  _this.imageForm.submit();
               }
             }
            }
           ]
          }
         ]
        }
       ]
      }
     },
     {
      background : true,
      region : 'center',
      title : _this._strings['f0bac093bb884df2891d32385d053788'] /* Distribution */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'NestedLayoutPanel',
      listeners : {
       activate : function (_self)
        {
            
            _this.distributionTab = _self;
            
            if (!_this.countrypanel) {
                return;
            }
            
            if (_this.form.findField('parent_id').getValue() * 1 > 0) {
                _self.el.mask("Distribution is done on Original Language version");
                return;
            
            
            }
            _self.el.unmask();
            
            
            _this.countrypanel.tree.root.reload(function() {
                _this.countrypanel.tree.expandAll();
                _this.countrypanel.tree.onloadComplete(function() {
        
                
                    //Roo.log("load Complete");
                       _this.beatgrid.ds.load({});
                        _this.countrypanel.tree.collapseUnchecked();               
                     // _this.distSummary.refreshContent();
                });
            });
                
             return;
        //    _this.distpanel = _self;
            var parent_id = _this.form.findField('parent_id').getValue(); 
            if (parent_id * 1 > 0) {
                _self.el.mask("This is a translation of #" + parent_id + " - set up the distribution on that release");
                return;
            } 
              _self.el.unmask();
           // _this.beatgrid.ds.load({});
           _this.countrygrid.ds.block_next_load = false;
           _this.countrygrid.ds.load({});
        
        }
      },
      toolbar : {
       xns : Roo,
       '|xns' : 'Roo',
       xtype : 'Toolbar',
       items  : [
        {
         xns : Roo.Toolbar,
         '|xns' : 'Roo.Toolbar',
         xtype : 'Fill'
        },
        {
         text : _this._strings['c864347be68dbc6a7b0540f1f79d8ea3'] /* Reset selections */,
         xns : Roo.Toolbar,
         '|xns' : 'Roo.Toolbar',
         xtype : 'Button',
         listeners : {
          click : function (_self, e)
           {
            
               _this.form.findField('distribution_countries').setValue('_generalnews');
               _this.form.findField('distribution_config').setValue( ''); 
                _this.countrypanel.tree.root.reload(function() {
                   _this.countrypanel.tree.expandAll();
                   _this.countrypanel.tree.onloadComplete(function() {
                       //Roo.log("load Complete");
                          _this.beatgrid.ds.load({});
                        // _this.distSummary.refreshContent();
                   });
               });
               
           }
         }
        }
       ]
      },
      layout : {
       xns : Roo,
       '|xns' : 'Roo',
       xtype : 'BorderLayout',
       center : {
        titlebar : true,
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'LayoutRegion'
       },
       west : {
        titlebar : true,
        width : 350,
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'LayoutRegion'
       },
       south : {
        height : 100,
        split : true,
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'LayoutRegion'
       },
       items  : [
        {
         autoScroll : true,
         fitToFrame : true,
         refreshContent : function() {
             // display a summary of what we need..
             
             
             function tr(k,v,vv) {
                 vv = vv || '';
                 return String.format('<tr><td style="text-align:right;width: 150px;"><b>{0}</b>: </td>' + 
                     '<td style="white-space: normal;">'+vv+'{1}</td></tr>' + "\n", k, v === false ? '' : v);
             }
             
             var beats = [];
             _this.beatgrid.ds.each(function(r) {
                 
                 if (r.data.member*1 < 1 ) {
                     return;
                 }
                 var n = (r.data.hgroup.length ? r.data.hgroup + ' : ' : '') + r.data.name; 
                 beats.push(n);
             });
             var rt = {};
             
             var total = '???';
             var cns_ar = _this.countrypanel.tree.getChecked('name');
         
             // remove general..
             var has_gen = false;
             cns_ar = cns_ar.filter(function(e, i, a) {
                 if (e == 'General News') {
                     has_gen = true;
                     return false;
                 }
                 return true;
             });
             this.setContent("Loading....");
             var _t = this;
             new Pman.Request({
                 url : baseURL+ '/Roo/Pressrelease_contact',
                 method : 'GET',
                 params : {
                     limit : 1,
                     'distfilter[beats]' : _this.form.findField('distribution_config').getValue(),
                     'distfilter[countries]' : _this.form.findField('distribution_countries').getValue()
                     
                 },
                 success : function(r) {
                    // Roo.log(r);
                     _t.setContent(
                         '<h3>Press release will be distributed to ' + r.total + ' Journalist' + ( r.total == 1 ? '' : 's') + ':</h3>' + 
                         '<table class="x-grid-row" style="width:100%">' + 
                             tr("General Distribution", false, has_gen ? 'YES' : '<span style="color:red">NO</span>') +  
                             tr("News Beats",beats.join(', ')) + 
                             tr("Countries", cns_ar.join(', '))  + 
                         "</table>");
                 }
             });
                         
         },
         region : 'south',
         xns : Roo,
         '|xns' : 'Roo',
         xtype : 'ContentPanel',
         listeners : {
          activate : function (_self)
           {
               _this.distSummary = _self;
           }
         }
        },
        {
         region : 'west',
         xns : Roo,
         '|xns' : 'Roo',
         xtype : 'TreePanel',
         listeners : {
          render : function (_self)
           {
              _this.countrypanel = this;
               
           }
         },
         tree : {
          collapseUnchecked : function() {
          
              var r = this.root;
              
              function closeNode  (n) {
                  if (n.leaf) { // do not look a leaves.
                      return false;
                  }
                  // do children first.
                  var chk = 0;
                  n.eachChild(function(nn) {
                      if (!nn.leaf) {
                          closeNode(nn);
                          // if they have leaf's keep them expanded
                          //if (nn.expanded) {
                              chk++;
                          //}
                          return;
                      }
          
                      if (nn.attributes.checked) {
                          chk++;
                      }
                      
                  });
                  if (chk > 0) { // something is checked or expanded.
                      return;
                  }
                  if (n != r) {
                      n.collapse(false, false);
                  }
          
              
              }
          
              closeNode(this.root);
          },
          isNodeLoaded : function(node) {
              if (node.leaf) {
                  return true;
              }
              if (!node.loaded) {
                  return false;
              }
              var ret = true;
              var t = this;
              node.eachChild(function(n) {
                  if (!t.isNodeLoaded(n)) {
                      ret = false;
                      return false;
                  }
              });
              return ret;
          
          },
          onloadComplete : function(fn) {
             
          
          
               var t = this;
                  // loop through all nodes and check if loaded  == true?
          
              if (!this.isNodeLoaded(this.root)) {
                  this.onloadComplete.defer(500, this, [ fn ], false);
                  return;
              }
              fn.call(this);
              
              
          },
          rootVisible : false,
          xns : Roo.tree,
          '|xns' : 'Roo.tree',
          xtype : 'TreePanel',
          listeners : {
           checkchange : function (node, checked)
            {
                var t= this;
                this.onloadComplete(function() {
                        _this.form.findField('distribution_countries').setValue(t.getChecked('id').join(','));
                     // _this.distSummary.refreshContent();
                       _this.beatgrid.ds.load({});
                });
                return;
                 
                 
                    
            },
           click : function (node, e)
            {
                    if (node.ui.checkbox) {
                       node.ui.checkbox.checked = !node.ui.checkbox.checked;
                       node.ui.onCheckChange();
                   }
            }
          },
          root : {
           checked : false,
           id : '_root',
           text : _this._strings['8189ecf686157db0c0274c1f49373318'] /* International */,
           xns : Roo.tree,
           '|xns' : 'Roo.tree',
           xtype : 'AsyncTreeNode'
          },
          loader : {
           baseParams : { _tree: 1, limit: 9999, sort: 'cname', dir : 'ASC'  },
           dataUrl : baseURL + '/Roo/Pressrelease_regionmap.php',
           requestMethod : 'GET',
           root : 'data',
           xns : Roo.tree,
           '|xns' : 'Roo.tree',
           xtype : 'TreeLoader',
           listeners : {
            create : function (This, attr)
             {
                //Roo.log(attr);
               // attr.text = "set in create handler";
               
               var v = _this.form.findField('distribution_countries').getValue();
               if (!v.length) {
                    v = '_generalnews';
                    _this.form.findField('distribution_countries').setValue(v);
             
               }
               var x = v.split(',');
              //Roo.log(x);
               
                attr.checked = x.indexOf(attr.id) > -1 ; // read from cfg..
             },
            load : function (This, node, response)
             {
               //  _this.beatgrid.ds.load({});
             }
           }
          },
          sm : {
           xns : Roo.tree,
           '|xns' : 'Roo.tree',
           xtype : 'DefaultSelectionModel',
           listeners : {
            beforeselect : function (_self, node, node)
             {
               return false;
             }
           }
          }
         }
        },
        {
         background : false,
         fitContainer : true,
         fitToframe : true,
         region : 'center',
         tableName : 'pressrelease_category',
         title : _this._strings['2bb46cdcd6c198689d1c95ac20bba931'] /* Beat */,
         xns : Roo,
         '|xns' : 'Roo',
         xtype : 'GridPanel',
         listeners : {
          activate : function() {
               
               if (_this.beatgrid) {
                   //_this.grid.ds.load({});
               }
           }
         },
         grid : {
          autoExpandColumn : 'name',
          loadMask : true,
          xns : Roo.grid,
          '|xns' : 'Roo.grid',
          xtype : 'Grid',
          listeners : {
           cellclick : function (_self, ri, ci , e)
            {
               if (ci != 1) {return; }
               
                var rec = this.ds.getAt(ri);
                rec.set('member', (rec.data.member * 1) ? 0 : 1);
                rec.commit();
            
                
                var cfg = [];
                
                _this.beatgrid.ds.each(function(r) {
                    if (r.data.member*1 < 1) {
                        return;
                    }
                    cfg.push(r.data.id);
                });
            
                _this.form.findField('distribution_config').setValue( cfg.join(','));
            
              //  _this.typegrid.ds.load({});
            
                 _this.distSummary.refreshContent();
            
               //_this.countrygrid.ds.load({});
            },
           render : function() 
            {
                _this.beatgrid = this; 
                //_this.dialog = Pman.Dialog.FILL_IN
                // if (_this.panel.active) {
                //   this.ds.load({});
                // }
            },
           rowclass : function (gridview, rowcfg)
            {
                 //Roo.log(rowcfg);
                 // determine if we need to show it..
                 var val=_this.beatfilter.getValue().toLowerCase();
                 rowcfg.rowClass= '';
                 if (!val.length) {
                    return; // always show..
                 }
                 var match = false;
                 var hg = rowcfg.record.data.hgroup.toLowerCase();
                 var n = rowcfg.record.data.name.toLowerCase();     
                 var re = new RegExp(val);
                 
                 if (hg.match(re) || n.match(re)) {
                    return; // display it..
                 }
                 //Roo.log('display none');
                 if (rowcfg.record.data.member * 1 > 0) {
                   // return;
                 }
                 rowcfg.rowClass = 'display-none';
                 
                 
            }
          },
          toolbar : {
           xns : Roo,
           '|xns' : 'Roo',
           xtype : 'Toolbar',
           items  : [
            {
             width : 100,
             xns : Roo.form,
             '|xns' : 'Roo.form',
             xtype : 'TextField',
             listeners : {
              keyup : function (_self, e)
               {
                      _this.beatgrid.view.refresh(true);
                   
               
               },
              render : function (_self)
               {
                 _this.beatfilter = _self;
               }
             }
            },
            {
             cls : 'x-btn-icon',
             icon : rootURL + '/Pman/templates/images/edit-clear.gif',
             xns : Roo.Toolbar,
             '|xns' : 'Roo.Toolbar',
             xtype : 'Button',
             listeners : {
              click : function (_self, e)
               {
                   _this.beatfilter.setValue('');
                    _this.beatgrid.view.refresh(true);
                   
               }
             }
            },
            {
             xns : Roo.Toolbar,
             '|xns' : 'Roo.Toolbar',
             xtype : 'Fill'
            },
            {
             text : _this._strings['526d688f37a86d3c3f27d0c5016eb71d'] /* Reset */,
             xns : Roo.Toolbar,
             '|xns' : 'Roo.Toolbar',
             xtype : 'Button',
             listeners : {
              click : function (_self, e)
               {
                   
                   
                   _this.beatgrid.ds.each(function(rec) {
                           rec.set('member', 0);
                           rec.commit();
                          
                   
               
                   });
               
               }
             }
            },
            {
             text : _this._strings['45e96c0a422ce8a1a6ec1bd5eb9625c6'] /* Select All */,
             xns : Roo.Toolbar,
             '|xns' : 'Roo.Toolbar',
             xtype : 'Button',
             listeners : {
              click : function (_self, e)
               {
                   
                    // determine if we need to show it..
                    var val =_this.beatfilter.getValue().toLowerCase();
                    var re = false;
                    if (val.length) {
                        re = new RegExp(val);
                       
                    }
                    
                   
                   
                   _this.beatgrid.ds.each(function(rec) {
                       if (!re) {        
                           rec.set('member',  1);
                           rec.commit();
                           return;
                       }
                        var hg = rec.data.hgroup.toLowerCase();
                        var n = rec.data.name.toLowerCase();
                         if (!hg.match(re) && !n.match(re)) {
                           return; // do not select it..
                        }
                   
                         rec.set('member',  1);
                       rec.commit();
                          
                   
               
                   });
               
               }
             }
            }
           ]
          },
          dataSource : {
           remoteSort : true,
           sortInfo : { field : 'hgroup,name', direction: 'ASC' },
           xns : Roo.data,
           '|xns' : 'Roo.data',
           xtype : 'Store',
           listeners : {
            beforeload : function (_self, options)
             {
                 if (!_this.form.findField('distribution_countries').getValue().length) {
                     this.beatgrid.ds.removeAll();
                 
                     return false;
                 }
                 options.params =     options.params || {};
                 options.params.parent_id_name = 'News Beat';
               //  options.params.for_beat = 1;
               //  options.params.contact_id = _this.data ? _this.data.id : 0;
                 options.params['query[with_empty_member]'] = 1; // this sets member=0 (blank list..)
                 
                 options.params['query[hide_empty_member]'] = 1;
                 
                 options.params['query[only_countries_tree]'] = _this.form.findField('distribution_countries').getValue();
               
                 options.params.limit = 999;
             },
            load : function (_self, records, options)
             {
                 var fdef = _this.form.findField('distribution_config')
                 // beat list is loaded..
                 // if there are no data.. we should clear the distribution config..
                 if (!records.length) {
                    
                     fdef.setValue('');
                      _this.distSummary.refreshContent();
                    // _this.typegrid.ds.load({});
                    return;
                 }
                 
                 
                 // otherwise, grab the first item.. find the parent id..
                 // filter that list to make sure that nothing that is selected is hidden...
                 
                
                 var def = fdef.getValue();    
             
                 if (def.length) {
             
                     var crecs = def.split(',');
                     
                     // crecs holds our current config...
                     
                     var avail = [];
                     
                     Roo.each(records, function(r) {
                     
                         if ( crecs.indexOf(''+r.data.id) > -1) {
                             r.set('member', 1);
                         }
                         avail.push(''+r.data.id);
                         
                     });
                     
                     // now clear out from crecs all the 
                     var crec_new = [];
                     Roo.each(crecs, function(r) {
                         if (avail.indexOf(r) > -1) {
                             crec_new.push(r);
                         }
                     });
                   
                     fdef.setValue( crec_new.join(','));
                     
                     
                 }
                     // update the summary
             _this.distSummary.refreshContent();
             
                //  _this.typegrid.ds.load({});
             }
           },
           proxy : {
            method : 'GET',
            url : baseURL + '/Roo/pressrelease_category.php',
            xns : Roo.data,
            '|xns' : 'Roo.data',
            xtype : 'HttpProxy'
           },
           reader : {
            fields : [
                {
                    'name': 'id',
                    'type': 'int'
                },
                {
                    'name': 'parent_id',
                    'type': 'int'
                },
                {
                    'name': 'name',
                    'type': 'string'
                },
                {
                    'name': 'display_order',
                    'type': 'int'
                },
                {
                    'name': 'visible',
                    'type': 'int'
                }
            ],
            id : 'id',
            root : 'data',
            totalProperty : 'total',
            xns : Roo.data,
            '|xns' : 'Roo.data',
            xtype : 'JsonReader'
           }
          },
          colModel : [
           {
            dataIndex : 'name',
            header : _this._strings['c9289663240146eaa1ec2d9838b0875a'] /* News Beat */,
            renderer : function(v,x,r) { return String.format('{0}', (r.data.hgroup ? r.data.hgroup + ' : ' : '') + v); },
            width : 200,
            xns : Roo.grid,
            '|xns' : 'Roo.grid',
            xtype : 'ColumnModel'
           },
           {
            dataIndex : 'member',
            header : _this._strings['e0626222614bdee31951d84c64e5e9ff'] /* Select */,
            renderer : function(v) {  
                var state = v> 0 ?  '-checked' : '';
            
                return '<img class="x-grid-check-icon' + state + '" src="' + Roo.BLANK_IMAGE_URL + '"/>';
                            
             },
            width : 75,
            xns : Roo.grid,
            '|xns' : 'Roo.grid',
            xtype : 'ColumnModel'
           }
          ]
         }
        }
       ]
      }
     },
     {
      background : true,
      fitContainer : true,
      fitToframe : true,
      region : 'center',
      tableName : 'pressrelease_notify',
      title : _this._strings['f45381a54504218e39aca33492d29306'] /* Circulation */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'GridPanel',
      listeners : {
       activate : function() {
            _this.circpanel = this;
            if (_this.circvtype) {
                _this.circvtype.setValue('FAILED');
            }
            if (_this.circgrid) {
                _this.circgrid.footer.onClick('first');
            }
        }
      },
      grid : {
       autoExpandColumn : 'person_id_firstname',
       loadMask : true,
       xns : Roo.grid,
       '|xns' : 'Roo.grid',
       xtype : 'Grid',
       listeners : {
        render : function() 
         {
             _this.circgrid = this; 
             //_this.dialog = Pman.Dialog.FILL_IN
             if (_this.circpanel.active) {
                this.footer.onClick('first');
             }
         },
        rowdblclick : function (_self, rowIndex, e)
         {
             var rec = this.ds.getAt(rowIndex);
             var g= this;
             Pman.Dialog.PressReleaseContact.show({ id : rec.data.person_id }, function()
             {
                 g.footer.onClick('first');
             });
         }
       },
       footer : {
        displayInfo : true,
        displayMsg : _this._strings['c78bf45129eff892d5c654c159fd8182'] /* Displaying pressrelease_notify{0} - {1} of {2} */,
        emptyMsg : _this._strings['47b09b64b87dc1cb923065dd6167ecde'] /* No pressrelease_notify found */,
        pageSize : 25,
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'PagingToolbar',
        items  : [
         {
          text : _this._strings['801ab24683a4a8c433c6eb40c48bcd9d'] /* Download */,
          xns : Roo.Toolbar,
          '|xns' : 'Roo.Toolbar',
          xtype : 'Button',
          listeners : {
           click : function (_self, e)
            {
             
                 new Pman.Download({
                      grid : _this.circgrid
                });
               Roo.MessageBox.alert("Downloading", "File should be downloading now");
            
            }
          }
         }
        ]
       },
       toolbar : {
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'Toolbar',
        items  : [
         {
          text : _this._strings['917d465e9a9e8b16a8da50a1ca8156ca'] /* Show:  */,
          xns : Roo.Toolbar,
          '|xns' : 'Roo.Toolbar',
          xtype : 'TextItem'
         },
         {
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'TextField',
          listeners : {
           render : function (_self)
            {
              _this.searchBox = _self;
            },
           specialkey : function (_self, e)
            {
            
                if (e.getCharCode() == 13) {
                    _this.circgrid.footer.onClick('first');
                }
            }
          }
         },
         {
          allowBlank : false,
          displayField : 'fname',
          editable : false,
          hiddenName : 'vtype',
          listWidth : 200,
          mode : 'local',
          name : 'vtype_name',
          triggerAction : 'all',
          value : _this._strings['b9e14d9b2886bcff408b85aefa780419'] /* FAILED */,
          valueField : 'ftype',
          width : 200,
          xns : Roo.form,
          '|xns' : 'Roo.form',
          xtype : 'ComboBox',
          listeners : {
           beforeselect : function (combo, record, index)
            {
                (function() {
                    _this.circgrid.footer.onClick('first');
                }).defer(100);
            },
           render : function (_self)
            {
              _this.circvtype = _self;
            }
          },
          store : {
           data : [ ['FAILED', "Failed"],[ 'DELIVERED' , "Delivered"],[ 'PENDING', "Pending"],[ 'ONLINE', "ONLINE"] ],
           fields : [  'ftype', 'fname'],
           xns : Roo.data,
           '|xns' : 'Roo.data',
           xtype : 'SimpleStore'
          }
         },
         {
          cls : 'x-btn-icon',
          icon : rootURL + '/Pman/templates/images/search.gif',
          xns : Roo.Toolbar,
          '|xns' : 'Roo.Toolbar',
          xtype : 'Button',
          listeners : {
           click : function (_self, e)
            {
            _this.circgrid.footer.onClick('first');
            }
          }
         },
         {
          cls : 'x-btn-icon',
          icon : rootURL + '/Pman/templates/images/edit-clear.gif',
          xns : Roo.Toolbar,
          '|xns' : 'Roo.Toolbar',
          xtype : 'Button',
          listeners : {
           click : function (_self, e)
            {
                _this.searchBox.setValue('');
                
                
                _this.circgrid.footer.onClick('first');
            }
          }
         },
         {
          xns : Roo.Toolbar,
          '|xns' : 'Roo.Toolbar',
          xtype : 'Fill'
         },
         {
          text : _this._strings['a97749f6323c1743aad997aaf0197b19'] /* Remove undelivered messages */,
          xns : Roo.Toolbar,
          '|xns' : 'Roo.Toolbar',
          xtype : 'Button',
          listeners : {
           click : function (_self, e)
            {
                var id = _this.form.findField('id').getValue()*1
                if (id < 1) {
                    Roo.MessageBox.alert("Error", "Save Release first");
                    return;
                }
            
                new Pman.Request({
                    url : baseURL + '/PressRelease/View/' + id,
                    params : {
                        reset : 1
                    },
                    method : 'POST',
                    success : function() 
                    {
                        _this.circgrid.footer.onClick('first');
                    } 
                
                });
            }
          }
         },
         {
          text : _this._strings['8567f15f1470a10fcb0dfa920ac7c21b'] /* Force Re-delivery */,
          xns : Roo.Toolbar,
          '|xns' : 'Roo.Toolbar',
          xtype : 'Button',
          listeners : {
           click : function (_self, e)
            {
                var id = _this.form.findField('id').getValue()*1
                if (id < 1) {
                    Roo.MessageBox.alert("Error", "Save Release first");
                    return;
                }
                var s = _this.circgrid.getSelectionModel().getSelections();
                if (!s || !s.length) {
                    Roo.MessageBox.alert("Error", "Select item to re-deliver");
                    return;
                }
                 
            
                new Pman.Request({
                    url : baseURL + '/PressRelease/View/' + id,
                    params : {
                        redeliver : s[0].data.id
                    },
                    method : 'POST',
                    success : function() 
                    {
                        _this.circgrid.footer.onClick('first');
                    } 
                
                });
            }
          }
         }
        ]
       },
       dataSource : {
        remoteSort : true,
        sortInfo : { field : 'ontable', direction: 'ASC' },
        xns : Roo.data,
        '|xns' : 'Roo.data',
        xtype : 'Store',
        listeners : {
         beforeload : function (_self, o)
          {
            o.params = o.params || {};
            o.params.ontable = 'pressrelease_entry';
            o.params.onid = _this.form.findField('id').getValue();
            if ( ! o.params.onid) {
               return false;
            
            }
            o.params['search[remarks]'] = _this.searchBox.getValue();
            
            o.params.vtype = _this.circvtype.getValue();
            
          }
        },
        proxy : {
         method : 'GET',
         url : baseURL + '/Roo/pressrelease_notify.php',
         xns : Roo.data,
         '|xns' : 'Roo.data',
         xtype : 'HttpProxy'
        },
        reader : {
         fields : [
             {
                 'name': 'id',
                 'type': 'int'
             },
             {
                 'name': 'act_when',
                 'type': 'date',
                 'dateFormat': 'Y-m-d'
             },
             {
                 'name': 'onid',
                 'type': 'int'
             },
             {
                 'name': 'ontable',
                 'type': 'string'
             },
             {
                 'name': 'person_id',
                 'type': 'int'
             },
             {
                 'name': 'msgid',
                 'type': 'string'
             },
             {
                 'name': 'sent',
                 'type': 'date',
                 'dateFormat': 'Y-m-d'
             },
             {
                 'name': 'bounced',
                 'type': 'int'
             },
             {
                 'name': 'person_id_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_category_type_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_honor',
                 'type': 'string'
             },
             {
                 'name': 'person_id_name',
                 'type': 'string'
             },
             {
                 'name': 'person_id_name_alt',
                 'type': 'string'
             },
             {
                 'name': 'person_id_company_id_name',
                 'type': 'string'
             },
             {
                 'name': 'person_id_role',
                 'type': 'string'
             },
             {
                 'name': 'person_id_email',
                 'type': 'string'
             },
             {
                 'name': 'person_id_email_personal',
                 'type': 'string'
             },
             {
                 'name': 'person_id_phone',
                 'type': 'string'
             },
             {
                 'name': 'person_id_fax',
                 'type': 'string'
             },
             {
                 'name': 'person_id_address',
                 'type': 'string'
             },
             {
                 'name': 'person_id_category_media_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_submission_time',
                 'type': 'string'
             },
             {
                 'name': 'person_id_publication_lang',
                 'type': 'string'
             },
             {
                 'name': 'person_id_url',
                 'type': 'string'
             },
             {
                 'name': 'person_id_remarks',
                 'type': 'string'
             },
             {
                 'name': 'person_id_phone_mobile',
                 'type': 'string'
             },
             {
                 'name': 'person_id_phone_direct',
                 'type': 'string'
             },
             {
                 'name': 'person_id_firstname',
                 'type': 'string'
             },
             {
                 'name': 'person_id_lastname',
                 'type': 'string'
             },
             {
                 'name': 'person_id_firstname_alt',
                 'type': 'string'
             },
             {
                 'name': 'person_id_lastname_alt',
                 'type': 'string'
             },
             {
                 'name': 'person_id_publication_name',
                 'type': 'string'
             },
             {
                 'name': 'person_id_publication_name_alt',
                 'type': 'string'
             },
             {
                 'name': 'person_id_category_scope_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_contact_language',
                 'type': 'string'
             },
             {
                 'name': 'person_id_contact_language_alt',
                 'type': 'string'
             },
             {
                 'name': 'person_id_country',
                 'type': 'string'
             },
             {
                 'name': 'person_id_best_contact_method',
                 'type': 'string'
             },
             {
                 'name': 'person_id_best_contact_from',
                 'type': 'string'
             },
             {
                 'name': 'person_id_best_contact_to',
                 'type': 'string'
             },
             {
                 'name': 'person_id_best_contact_days',
                 'type': 'string'
             }
         ],
         id : 'id',
         root : 'data',
         totalProperty : 'total',
         xns : Roo.data,
         '|xns' : 'Roo.data',
         xtype : 'JsonReader'
        }
       },
       colModel : [
        {
         dataIndex : 'id',
         header : _this._strings['9c9745a343efeacc9efe9b7222b27afb'] /* Ref# */,
         renderer : function(v) { return String.format('{0}', v); },
         width : 50,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'evtype',
         header : _this._strings['a1fa27779242b4902f7ae3bdd5c6d508'] /* Type */,
         renderer : function(v) { return String.format('{0}', v); },
         width : 50,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'act_when',
         header : _this._strings['122a26ef126e03089bb959c949d12b0a'] /* Due out (Local time) */,
         renderer : function(v) { return String.format('{0}', v ? v.format('d/M/Y H:i') : ''); },
         width : 150,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'person_id_firstname',
         header : _this._strings['e12167aa0a7698e6ebc92b4ce3909b53'] /* To */,
         renderer : function(v,x,r) { 
         
             if (r.data.person_id < 0) {
                 return String.format('{0} <a qtip="{1}" href="mailto:{1}">{1}</a>>', 
                     r.data.firstname, r.data.to_email); 
             
             }
             
             if (!Pman.hasPerm('PressRelease.JournalistAll', 'S')) {
                 return String.format('{0} {1} ({2})', 
                         v, r.data.person_id_lastname, r.data.person_id_publication_name
                 );     
             }
         
             return String.format('<a qtip="{3}" href="mailto:{3}">{0} {1}</a> ({2})', 
                 v, r.data.person_id_lastname,  r.data.person_id_publication_name,
                  r.json['person_id_' + r.data.field]); 
         },
         width : 150,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'sent',
         header : _this._strings['7f8c0283f16925caed8e632086b81b9c'] /* Sent */,
         renderer : function(v,x,r) 
         { 
             var prefix = '';
             if (r.data.person_id < 0) {
                 prefix = 'MANUAL SEND: ';
             
             }
         
            if (!r.data.event_id) {
                 return prefix + 'not sent yet';
            }
            
             return String.format(prefix + '{0}', v ? v.format('d/M/Y H:i:s') : ''); 
         },
         width : 150,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'event_id_remarks',
         header : _this._strings['ec53a8c4f07baed5d8825072c89799be'] /* Status */,
         renderer : function(v) { 
              
             return String.format('<span qtip="{1}">{0}</span>', v,String.format('{0}', v)); 
         },
         width : 150,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        }
       ]
      }
     },
     {
      background : true,
      fitContainer : true,
      fitToframe : true,
      region : 'center',
      tableName : 'Events',
      title : _this._strings['ce0be71e33226e4c1db2bcea5959f16b'] /* Log */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'GridPanel',
      listeners : {
       activate : function() {
            _this.panel = this;
            if (_this.grid) {
                _this.grid.footer.onClick('first');
            }
        }
      },
      grid : {
       autoExpandColumn : 'remarks',
       loadMask : true,
       xns : Roo.grid,
       '|xns' : 'Roo.grid',
       xtype : 'Grid',
       listeners : {
        render : function() 
         {
             _this.grid = this; 
             //_this.dialog = Pman.Dialog.FILL_IN
             if (_this.panel.active) {
                this.footer.onClick('first');
             }
         },
        rowdblclick : function (_self, rowIndex, e)
         {
             if (!_this.dialog) return;
             _this.dialog.show( this.getDataSource().getAt(rowIndex), function() {
                 _this.grid.footer.onClick('first');
             }); 
         }
       },
       footer : {
        displayInfo : true,
        displayMsg : _this._strings['7205d42d6d975c911bc1147259d78935'] /* Displaying Events{0} - {1} of {2} */,
        emptyMsg : _this._strings['90e4ac2e5a22e53df63b6b186d8727ba'] /* No Events found */,
        pageSize : 25,
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'PagingToolbar'
       },
       dataSource : {
        remoteSort : true,
        sortInfo : { field : 'event_when', direction: 'DESC' },
        xns : Roo.data,
        '|xns' : 'Roo.data',
        xtype : 'Store',
        listeners : {
         beforeload : function (_self, o)
          {
              if (!_this.data || !_this.data.id) {
                  return false;
              }
              o.params.on_table = 'pressrelease_entry';
              o.params.on_id = _this.data.id;
              
          }
        },
        proxy : {
         method : 'GET',
         url : baseURL + '/Roo/Events.php',
         xns : Roo.data,
         '|xns' : 'Roo.data',
         xtype : 'HttpProxy'
        },
        reader : {
         fields : [
             {
                 'name': 'id',
                 'type': 'int'
             },
             {
                 'name': 'person_name',
                 'type': 'string'
             },
             {
                 'name': 'event_when',
                 'type': 'date',
                 'dateFormat': 'Y-m-d'
             },
             {
                 'name': 'action',
                 'type': 'string'
             },
             {
                 'name': 'ipaddr',
                 'type': 'string'
             },
             {
                 'name': 'on_id',
                 'type': 'int'
             },
             {
                 'name': 'on_table',
                 'type': 'string'
             },
             {
                 'name': 'person_id',
                 'type': 'int'
             },
             {
                 'name': 'remarks',
                 'type': 'string'
             },
             {
                 'name': 'person_id_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_office_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_name',
                 'type': 'string'
             },
             {
                 'name': 'person_id_phone',
                 'type': 'string'
             },
             {
                 'name': 'person_id_fax',
                 'type': 'string'
             },
             {
                 'name': 'person_id_email',
                 'type': 'string'
             },
             {
                 'name': 'person_id_company_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_role',
                 'type': 'string'
             },
             {
                 'name': 'person_id_active',
                 'type': 'int'
             },
             {
                 'name': 'person_id_remarks',
                 'type': 'string'
             },
             {
                 'name': 'person_id_passwd',
                 'type': 'string'
             },
             {
                 'name': 'person_id_owner_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_lang',
                 'type': 'string'
             },
             {
                 'name': 'person_id_no_reset_sent',
                 'type': 'int'
             },
             {
                 'name': 'person_id_action_type',
                 'type': 'string'
             },
             {
                 'name': 'person_id_project_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_deleted_by',
                 'type': 'int'
             },
             {
                 'name': 'person_id_deleted_dt',
                 'type': 'date'
             }
         ],
         id : 'id',
         root : 'data',
         totalProperty : 'total',
         xns : Roo.data,
         '|xns' : 'Roo.data',
         xtype : 'JsonReader'
        }
       },
       colModel : [
        {
         dataIndex : 'event_when',
         header : _this._strings['4e97aeeaa8b15ca1180fcd1f3ac478d1'] /* When */,
         renderer : function(v) { return String.format('{0}', v ? v.format('d/M/Y H:i') : ''); },
         width : 150,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'person_id_name',
         header : _this._strings['4ee972120bcda675f75222c87cb9d356'] /* Who */,
         renderer : function(v) { return String.format('{0}', v); },
         width : 100,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'action',
         header : _this._strings['004bf6c9a40003140292e97330236c53'] /* Action */,
         renderer : function(v) { return String.format('{0}', v); },
         width : 75,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'remarks',
         header : _this._strings['231bc72756b5e6de492aaaa1577f61b1'] /* Remarks */,
         renderer : function(v) { return String.format('<span qtip="{0}">{1}</span>', 
             Roo.util.Format.htmlEncode(v),v); },
         width : 200,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        }
       ]
      }
     },
     {
      region : 'center',
      title : _this._strings['867343577fa1f33caa632a19543bd252'] /* Keywords */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'TreePanel',
      listeners : {
       activate : function (_self)
        {
            _this.treepanel.el.mask('Before you add a keyword, please publish release first');
            
            _this.treepanel.tree.getRootNode().reload(function() {
                _this.treepanel.tree.getRootNode().expand(true,true);
            });
            
            if(_this.form.findField('project_id').getValue()*1 > 0 || 
               _this.form.findField('parent_id_project_id').getValue()*1 > 0){
                _this.treepanel.el.unmask();
            }
            
            
        },
       render : function (_self)
        {
          _this.treepanel = _self;
        }
      },
      toolbar : {
       xns : Roo,
       '|xns' : 'Roo',
       xtype : 'Toolbar',
       items  : [
        {
         text : _this._strings['ec211f7c20af43e742bf2570c3cb84f9'] /* Add */,
         xns : Roo.Toolbar,
         '|xns' : 'Roo.Toolbar',
         xtype : 'Button',
         menu : {
          xns : Roo.menu,
          '|xns' : 'Roo.menu',
          xtype : 'Menu',
          items  : [
           {
            text : _this._strings['69046eb2a80f3965bcd41bfdb1a7bf5c'] /* Add Keyword */,
            xns : Roo.menu,
            '|xns' : 'Roo.menu',
            xtype : 'Item',
            listeners : {
             click : function (_self, e)
              {
                  if(!_this.form.findField('project_id').getValue()*1 && !_this.form.findField('parent_id_project_id').getValue()*1){
                      Roo.MessageBox.alert('Error', 'Please publish release first');
                      return;
                  }
                  var sn  = _this.treepanel.tree.getSelectionModel().getSelectedNode();
                  if(!sn || sn.leaf || sn.id == 'keyword'){
                      sn = 0;
                  }
                  Pman.Dialog.ClippingKeyword.show({
                          project_id: (_this.form.findField('project_id').getValue()) ? _this.form.findField('project_id').getValue() : _this.form.findField('parent_id_project_id').getValue(),
                          language: _this.form.findField('language').getValue(),
                          is_keyword : 1,
                          parent_id: sn ? sn.id : 0
                      },
                      function () {
                          (sn || _this.treepanel.tree.getRootNode()).reload(); 
                  });
              }
            }
           },
           {
            text : _this._strings['b112803ab9deb7deba2a6b24ef3bb91a'] /* Add Group */,
            xns : Roo.menu,
            '|xns' : 'Roo.menu',
            xtype : 'Item',
            listeners : {
             click : function (_self, e)
              {
                  //var sn  = _this.treepanel.tree.getSelectionModel().getSelectedNode();
                  if(!_this.form.findField('project_id').getValue()*1 && !_this.form.findField('parent_id_project_id').getValue()*1){
                      Roo.MessageBox.alert('Error', 'Please publish release first');
                      return;
                  }
                  Pman.Dialog.ClippingKeywordGroup.show({
                      project_id: (_this.form.findField('project_id').getValue()) ? _this.form.findField('project_id').getValue() : _this.form.findField('parent_id_project_id').getValue(),
                      language: _this.form.findField('language').getValue(),
                      parent_id: 0
                  },
                  function () {
                      _this.treepanel.tree.getRootNode().reload();
                  });
              }
            }
           }
          ]
         }
        },
        {
         text : _this._strings['f2a6c498fb90ee345d997f888fce3b18'] /* Delete */,
         xns : Roo.Toolbar,
         '|xns' : 'Roo.Toolbar',
         xtype : 'Button',
         listeners : {
          click : function (_self, e)
           {
               if(!_this.form.findField('project_id').getValue()*1){
                   Roo.MessageBox.alert('Error', 'Please publish release first');
                   return;
               }
               var tree = _this.treepanel.tree;
               var sn  = tree.getSelectionModel().getSelectedNode();
               if (!sn || isNaN(sn.id *1)) {
                   Roo.MessageBox.alert("Error", "Select a keyword");
                   return;
               }
               Roo.MessageBox.confirm("Confirm", "Are sure you want to delete the keyword?", function (v){
                   if (v != 'yes') {
                       return;
                   }
                   
                   new Pman.Request({
                       url : baseURL + '/Roo/Clipping_keywords',
                       method: 'POST',
                       params : {
                           _delete : sn.id
                       },
                       success : function()
                       {
                          //_this.treepanel.tree.getRootNode().reload();
                          sn.parentNode.removeChild(sn);
                          
                           //g.getDataSource().reload();
                       }
                   });
               });
           }
         }
        },
        {
         text : _this._strings['91412465ea9169dfd901dd5e7c96dd99'] /* Upload */,
         xns : Roo.Toolbar,
         '|xns' : 'Roo.Toolbar',
         xtype : 'Button'
        },
        {
         text : _this._strings['4d1c8263ba1036754f8db14a98f9f006'] /* Reload */,
         xns : Roo.Toolbar,
         '|xns' : 'Roo.Toolbar',
         xtype : 'Button',
         listeners : {
          click : function (_self, e)
           {
               if(!_this.form.findField('project_id').getValue()*1){
                   Roo.MessageBox.alert('Error', 'Please publish release first');
                   return;
               }
               _this.treepanel.tree.getRootNode().reload();
           }
         }
        }
       ]
      },
      tree : {
       containerScroll : true,
       ddScroll : true,
       enableDD : true,
       rendererTip : function(attr) {
           var alternatives = (attr.alternatives) ? attr.alternatives : '';
           return attr.text + '<br/>' + alternatives.split('\n').join('<br/>');
       },
       rootVisible : false,
       xns : Roo.tree,
       '|xns' : 'Roo.tree',
       xtype : 'TreePanel',
       listeners : {
        beforenodedrop : function (dropEvent)
         {
             Roo.log(dropEvent);
             Roo.log(dropEvent.target);
             
             
             var target_parent = dropEvent.point ==  'append' ? 
                     dropEvent.target : dropEvent.target.parentNode;
                     
             // same parent
             Roo.log(target_parent);
             if (target_parent.id == dropEvent.data.node.parentNode.id) {
                  dropEvent.cancel = true;
                  return;
             }
             
             
             var tree = this;
             if(!target_parent.leaf){
                 // parent is not a 'keyword'
                 // make sure we are dragging a keyword
                 if(dropEvent.data.node.leaf){
                     new Pman.Request({
                         url : baseURL + '/Roo/Clipping_keywords',
                         method: 'POST',
                         params : {
                             parent_id : target_parent.id == 'keyword' ? 0 : target_parent.id,
                             id : dropEvent.data.node.id
                         },
                         success : function()
                         {
                             //_this.treepanel.tree.getRootNode().reload();
                             //g.getDataSource().reload();
                         },
                         failure : function(){
                             Roo.MessageBox.alert("Error", "problem saving change, please try again");
                             _this.treepanel.tree.getRootNode().reload();
                         }
                     });
                 }else{
                     dropEvent.cancel = true;
                 }
             }else{
                 dropEvent.cancel = true;
                 Roo.MessageBox.confirm("Confirm", "Do you want to add this to alternatives?", function (v){
                     if (v != 'yes') {
                        // _this.treepanel.tree.getRootNode().reload();
                         return;
                     }
         
                     var alt = dropEvent.target.attributes.alternatives;
                     alt = alt || '';
                     alt += (alt && alt.length) ? "\n" : '';
                     alt += dropEvent.data.node.text;
                      dropEvent.target.attributes.alternatives = alt;
                      
                      dropEvent.data.node.parentNode.removeChild(dropEvent.data.node);
                      // update the tip..
                      dropEvent.target.ui.textNode.setAttribute('qtip', tree.rendererTip(dropEvent.target.attributes));
                      
                     new Pman.Request({
                         url : baseURL + '/Roo/Clipping_keywords',
                         method: 'POST',
                         params : {
                             id : dropEvent.target.id,
                             alternatives : alt
                         },
                         success : function()
                         {
                             new Pman.Request({
                                 url : baseURL + '/Roo/Clipping_keywords',
                                 method: 'POST',
                                 params : {
                                     _delete : dropEvent.data.node.id
                                 },
                                 success : function()
                                 {
                                   // _this.treepanel.tree.getRootNode().reload();
                                     //g.getDataSource().reload();
                                 }
                             });
                         }
                     });
                 });
             }
         
         },
        dblclick : function (node, e)
         {
             var     tree =this;
             if(parseInt(node.attributes.is_keyword)){
                 Pman.Dialog.ClippingKeyword.show({id:node.attributes.id},
                 function (res) {
                     node.attributes.alternatives = res.alternatives;
                     node.attributes.keyword = res.keyword; 
                     node.attributes.text = res.keyword;             
                     
                     node.setText(res.keyword);
                     node.ui.textNode.setAttribute('qtip', tree.rendererTip(node.attributes));
                    
                     //_this.treepanel.tree.getRootNode().reload();
                 });
             }else{
                 Pman.Dialog.ClippingKeywordGroup.show({id:node.attributes.id},
                 function (res) {
         
                     node.attributes.keyword = res.keyword; 
                     node.attributes.text = res.keyword;             
                     
                     node.setText(res.keyword);
         
         
                 });
             }
         }
       },
       root : {
        id : 'keyword',
        text : _this._strings['d7df5b64df1181ef1d62d646a13aa860'] /* keyword */,
        xns : Roo.tree,
        '|xns' : 'Roo.tree',
        xtype : 'AsyncTreeNode'
       },
       loader : {
        baseParams : {_tree:1},
        dataUrl : baseURL + '/Roo/Clipping_keywords',
        requestMethod : 'GET',
        xns : Roo.tree,
        '|xns' : 'Roo.tree',
        xtype : 'TreeLoader',
        listeners : {
         beforeload : function (This, node, callback)
          {
              this.baseParams._tree = 1;
              if (!_this.form) {
                  return false;
              }
              
              var pid = (_this.form.findField('parent_id').getValue()*1 > 0 && _this.form.findField('parent_id_project_id').getValue()*1 > 0) ?
                       _this.form.findField('parent_id_project_id').getValue() : _this.form.findField('project_id').getValue()
              
              this.baseParams.project_id = pid;
              this.baseParams.language = _this.form.findField('language').getValue();
          },
         create : function (This, attr)
          {
          
              attr.text =  attr.text;
              attr.allowChildren = true;
          }
        }
       },
       selModel : {
        xns : Roo.tree,
        '|xns' : 'Roo.tree',
        xtype : 'DefaultSelectionModel'
       }
      }
     },
     {
      background : true,
      fitContainer : true,
      fitToframe : true,
      region : 'center',
      tableName : 'Events',
      title : _this._strings['c91c7b93c28cd18741b71f727ee81ee3'] /* Reports */,
      xns : Roo,
      '|xns' : 'Roo',
      xtype : 'GridPanel',
      listeners : {
       activate : function() {
            _this.notifypanel = this;
            if (_this.notifygrid) {
                _this.grid.notifyfooter.onClick('first');
            }
        }
      },
      grid : {
       autoExpandColumn : 'to_email',
       loadMask : true,
       xns : Roo.grid,
       '|xns' : 'Roo.grid',
       xtype : 'Grid',
       listeners : {
        render : function() 
         {
             _this.notifygrid = this; 
             //_this.dialog = Pman.Dialog.FILL_IN
             if (_this.notifypanel.active) {
                this.footer.onClick('first');
             }
         },
        rowdblclick : function (_self, rowIndex, e)
         {
         
         
              var fd = _this.form.getFieldValues();
              var dt = Date.parseDate (
                 fd.publish_dt_day + ' ' + fd.publish_dt_hr
              , "Y-m-d H:i");
              Roo.log(dt);
               
              Pman.Dialog.PressReleaseReportNotify.show({
                     id : this.getDataSource().getAt(rowIndex).data.id,
                     release_dt : dt,
                     act_when_tz: fd.publish_dt_tz
                     
                 }, function() {
                  _this.notifygrid.footer.onClick('refresh');
              });
         
         
         }
       },
       footer : {
        displayInfo : true,
        displayMsg : _this._strings['7205d42d6d975c911bc1147259d78935'] /* Displaying Events{0} - {1} of {2} */,
        emptyMsg : _this._strings['90e4ac2e5a22e53df63b6b186d8727ba'] /* No Events found */,
        pageSize : 25,
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'PagingToolbar'
       },
       toolbar : {
        xns : Roo,
        '|xns' : 'Roo',
        xtype : 'Toolbar',
        items  : [
         {
          cls : 'x-btn-text-icon',
          icon : Roo.rootURL + 'images/default/dd/drop-add.gif',
          text : _this._strings['ec211f7c20af43e742bf2570c3cb84f9'] /* Add */,
          xns : Roo.Toolbar,
          '|xns' : 'Roo.Toolbar',
          xtype : 'Button',
          listeners : {
           click : function()
            {
                 var fd = _this.form.getFieldValues();
                 var dt = Date.parseDate (
                    fd.publish_dt_day + ' ' + fd.publish_dt_hr
                 , "Y-m-d H:i");
                 Roo.log(dt);
                 
                 Pman.Dialog.PressReleaseReportNotify.show({
                        ontable:  'pressrelease_entry',
                        onid : _this.data.id,
                        evtype : 'distributionReport',
                        release_dt : dt,
                        act_when_tz: fd.publish_dt_tz
                        
                    }, function() {
                     _this.notifygrid.footer.onClick('refresh');
                 });
            },
           render : function (_self)
            {
                _this.addItemBtn = _self;
            }
          }
         },
         {
          xns : Roo.Toolbar,
          '|xns' : 'Roo.Toolbar',
          xtype : 'Fill'
         },
         {
          cls : 'x-btn-text-icon',
          icon : rootURL + '/Pman/templates/images/trash.gif',
          text : _this._strings['f2a6c498fb90ee345d997f888fce3b18'] /* Delete */,
          xns : Roo.Toolbar,
          '|xns' : 'Roo.Toolbar',
          xtype : 'Button',
          listeners : {
           click : function()
                    {
                    Pman.genericDelete(_this.notifypanel, 'core_notify'); 
                    }
          }
         }
        ]
       },
       dataSource : {
        remoteSort : true,
        sortInfo : { field : 'event_when', direction: 'DESC' },
        xns : Roo.data,
        '|xns' : 'Roo.data',
        xtype : 'Store',
        listeners : {
         beforeload : function (_self, o)
          {
              if (!_this.data || !_this.data.id) {
                  return false;
              }
              o.params.ontable = 'pressrelease_entry';
              o.params.onid = _this.data.id;
              o.params.evtype = 'distributionReport';
              
              
          }
        },
        proxy : {
         method : 'GET',
         url : baseURL + '/Roo/core_notify.php',
         xns : Roo.data,
         '|xns' : 'Roo.data',
         xtype : 'HttpProxy'
        },
        reader : {
         fields : [
             {
                 'name': 'id',
                 'type': 'int'
             },
             {
                 'name': 'person_name',
                 'type': 'string'
             },
             {
                 'name': 'event_when',
                 'type': 'date',
                 'dateFormat': 'Y-m-d'
             },
             {
                 'name': 'action',
                 'type': 'string'
             },
             {
                 'name': 'ipaddr',
                 'type': 'string'
             },
             {
                 'name': 'on_id',
                 'type': 'int'
             },
             {
                 'name': 'on_table',
                 'type': 'string'
             },
             {
                 'name': 'person_id',
                 'type': 'int'
             },
             {
                 'name': 'remarks',
                 'type': 'string'
             },
             {
                 'name': 'person_id_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_office_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_name',
                 'type': 'string'
             },
             {
                 'name': 'person_id_phone',
                 'type': 'string'
             },
             {
                 'name': 'person_id_fax',
                 'type': 'string'
             },
             {
                 'name': 'person_id_email',
                 'type': 'string'
             },
             {
                 'name': 'person_id_company_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_role',
                 'type': 'string'
             },
             {
                 'name': 'person_id_active',
                 'type': 'int'
             },
             {
                 'name': 'person_id_remarks',
                 'type': 'string'
             },
             {
                 'name': 'person_id_passwd',
                 'type': 'string'
             },
             {
                 'name': 'person_id_owner_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_lang',
                 'type': 'string'
             },
             {
                 'name': 'person_id_no_reset_sent',
                 'type': 'int'
             },
             {
                 'name': 'person_id_action_type',
                 'type': 'string'
             },
             {
                 'name': 'person_id_project_id',
                 'type': 'int'
             },
             {
                 'name': 'person_id_deleted_by',
                 'type': 'int'
             },
             {
                 'name': 'person_id_deleted_dt',
                 'type': 'date'
             }
         ],
         id : 'id',
         root : 'data',
         totalProperty : 'total',
         xns : Roo.data,
         '|xns' : 'Roo.data',
         xtype : 'JsonReader'
        }
       },
       colModel : [
        {
         dataIndex : 'act_start',
         header : _this._strings['4b1b4dc8cf38b3c64b1d657da8f5ac8c'] /* Report */,
         renderer : function(v) { 
           if (!v) { 
                return '??';
           }
            var fd = _this.form.getFieldValues();
             var reltime = Date.parseDate (
                 fd.publish_dt_day + ' ' + fd.publish_dt_hr
              , "Y-m-d H:i");
         
                
            var tz =  fd.publish_dt_tz;
          
            var parts = tz.split('.');
            
            var hkt = reltime.add(Date.HOUR, -1 * parts[0]).add(Date.MINUTE, -1 * parts[1]).add(Date.HOUR, 8);
            
           
            var diff =  Math.round(v.getElapsed(hkt) / (1000 * 60 * 60 * 24));
           return '' + diff + ' Days';
         
         //return String.format('{0}', v ? v.format('d/M/Y H:i') : ''); 
         
         
         
         },
         width : 150,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'act_start',
         header : _this._strings['4e97aeeaa8b15ca1180fcd1f3ac478d1'] /* When */,
         renderer : function(v) { 
           if (!v) { 
                return '??';
           }
            return v.format('d/M/Y h:ia'); 
         
         },
         width : 150,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'to_email',
         header : _this._strings['4ee972120bcda675f75222c87cb9d356'] /* Who */,
         renderer : function(v) { return String.format('{0}', v); },
         width : 100,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'sent',
         header : _this._strings['7f8c0283f16925caed8e632086b81b9c'] /* Sent */,
         renderer : function(v,x,r) {
             if (!v || v < r.data.act_start) {
                 return '';
             }
             return v.format('d/M/Y H:i');
         
           },
         width : 200,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        },
        {
         dataIndex : 'id',
         header : _this._strings['9c9745a343efeacc9efe9b7222b27afb'] /* Ref# */,
         renderer : function(v) { return String.format('{0}', v); },
         width : 50,
         xns : Roo.grid,
         '|xns' : 'Roo.grid',
         xtype : 'ColumnModel'
        }
       ]
      }
     }
    ]
   });
 }
};
